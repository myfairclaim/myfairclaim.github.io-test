<!DOCTYPE html>
<!-- MyFairClaim Professional Tools - Fair Claim Submission Playbook™ v3.0 COMPLETE | Last Updated: 2024-12-25 -->
<!-- ALL 20 USABILITY OPTIMIZATIONS IMPLEMENTED -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="MyFairClaim Professional Fair Claim Submission Playbook™ - File your diminished value claim with state-specific legal guidance">
    <title>Fair Claim Submission Playbook™ - MyFairClaim Professional</title>
    <link rel="icon" type="image/png" href="https://myfairclaim.github.io/logo.png">
    <link rel="apple-touch-icon" href="https://myfairclaim.github.io/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Prevent text overflow globally */
        body, p, span, div, a, li, td, th {
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --success: #059669;
            --success-dark: #047857;
            --warning: #f59e0b;
            --error: #dc2626;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --navy: #1e40af;
            --navy-dark: #1e3a8a;
        }
        
        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: var(--gray-900);
            padding-bottom: 60px;
            line-height: 1.6;
            overflow-x: hidden;
            max-width: 100vw;
        }

        /* ESTIMATED TIME BANNER */
        /* TIER BANNER */
        .tier-banner {
            position: relative;
            background: linear-gradient(135deg, #C0C0C0 0%, #E8E8E8 50%, #C0C0C0 100%);
            color: #1a1a1a;
            padding: 40px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid #94a3b8;
        }
        .tier-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        /* NEW ANIMATIONS */
        @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 4px 24px rgba(59, 130, 246, 0.7), 0 0 0 8px rgba(59, 130, 246, 0.15); }
        }
        
        @keyframes checkPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6), 0 0 0 4px rgba(59, 130, 246, 0.1); }
        }
        
        @keyframes glowRed {
            0%, 100% { box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3); }
            50% { box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6), 0 0 0 4px rgba(220, 38, 38, 0.1); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInLeft {
            from { width: 0; opacity: 0; }
            to { width: 4px; opacity: 1; }
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        @keyframes slideInFromRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Accessibility: Disable animations for users who prefer reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        .tier-banner-content {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
        }
        .banner-logo {
            height: 220px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }
        .banner-text { flex: 1; }
        .tier-name {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            color: #1a1a1a;
        }
        .tier-subtitle {
            font-size: 19px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1a1a1a;
        }
        .tier-value-prop {
            font-size: 16px;
            font-weight: 400;
            line-height: 1.6;
            max-width: 800px;
            color: #333;
        }

        /* HEADER */
        .header {
            background: white;
            padding: 20px 30px 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            text-align: center;
        }
        .title-section { 
            width: 100%;
            text-align: center;
        }
        .title {
            font-size: 32px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        .tagline {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            font-style: italic;
        }
        .features {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .feature-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid var(--primary);
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            color: #1e40af;
        }
        .feature-badge svg {
            width: 18px;
            height: 18px;
        }

        /* PROGRESS INDICATOR */
        .progress-container {
            background: white;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .progress-inner {
            max-width: 1400px;
            margin: 0 auto;
        }
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
            margin-bottom: 20px;
        }
        .progress-line {
            position: absolute;
            top: 24px;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gray-200);
            z-index: 0;
        }
        .progress-line-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }
        .progress-step {
            position: relative;
            z-index: 1;
            text-align: center;
            flex: 1;
            min-width: 100px;
        }
        .progress-step-circle {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--gray-200);
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: var(--gray-400);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .progress-step.completed .progress-step-circle {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        .progress-step.completed .progress-step-circle svg {
            width: 24px;
            height: 24px;
        }
        .progress-step.active .progress-step-circle {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
            animation: pulse 2s ease-in-out infinite;
        }
        .progress-step-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-500);
            transition: color 0.3s;
        }
        .progress-step.active .progress-step-label {
            color: var(--primary);
            font-weight: 700;
        }
        .progress-step.completed .progress-step-label {
            color: var(--success-dark);
        }
        .progress-percentage {
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-top: 15px;
        }

        /* PREPARATION CHECKLIST */
        .prep-checklist {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 3px solid #000;
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            max-width: 1100px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: prepPulse 2s ease-in-out 3;
        }
        @keyframes prepPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
            50% { transform: scale(1.02); box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25); }
        }
        .prep-title {
            font-size: 20px;
            font-weight: 800;
            color: #000;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .prep-title svg {
            width: 32px;
            height: 32px;
        }
        .prep-minimize-btn {
            margin-left: auto;
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .prep-minimize-btn:hover {
            background: var(--gray-200);
            color: var(--gray-700);
        }
        .prep-minimize-btn svg {
            transition: transform 0.3s;
        }
        .prep-checklist.minimized .prep-minimize-btn svg {
            transform: rotate(-180deg);
        }
        .prep-items-container {
            transition: all 0.3s;
            max-height: 500px;
            overflow: hidden;
        }
        .prep-checklist.minimized .prep-items-container {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
        }
        .prep-checklist.minimized .prep-title {
            margin-bottom: 0;
        }
        .prep-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .prep-item:hover {
            border-color: var(--gray-300);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }
        .prep-checkbox {
            width: 20px;
            height: 20px;
            min-width: 20px;
            border: 2px solid var(--gray-300);
            border-radius: 6px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .prep-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
        }
        .prep-checkbox.checked svg {
            width: 14px;
            height: 14px;
            stroke: white;
            stroke-width: 3;
        }
        .prep-text {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
            line-height: 1.5;
        }

        /* MAIN CONTAINER */
        .main-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 30px;
            align-items: start;
        }

        /* SIDEBAR */
        .sidebar {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            position: sticky;
            top: 80px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            overflow-x: hidden;
        }
        /* Smooth scrollbar for sidebar */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        .sidebar-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gray-900);
        }
        .sidebar-title svg {
            width: 24px;
            height: 24px;
        }
        .step {
            margin-bottom: 20px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: 12px;
            border-left: 4px solid var(--gray-200);
            transition: all 0.3s;
        }
        .step:hover {
            background: var(--gray-100);
            transform: translateX(4px);
        }
        .step.completed {
            border-left-color: var(--success);
            background: #f0fdf4;
        }
        .step.active {
            border-left-color: var(--primary);
            background: #eff6ff;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
            position: relative;
        }
        .step.active::before {
            content: '';
            position: absolute;
            left: -4px;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            border-radius: 0 2px 2px 0;
            animation: slideInLeft 0.3s ease-out;
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-500);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 700;
            margin-right: 10px;
        }
        .step.completed .step-number {
            background: var(--success);
        }
        .step.active .step-number {
            background: var(--primary);
        }
        .step-text {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            line-height: 1.6;
        }
        .step-text strong {
            color: var(--gray-900);
        }
        .sidebar-tip {
            margin-top: 28px;
            padding: 18px;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }
        .sidebar-tip-title {
            font-size: 14px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .sidebar-tip-text {
            font-size: 13px;
            color: #1e40af;
            line-height: 1.5;
        }

        /* CONTENT */
        .content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        /* NAVIGATION TABS */
        .tabs {
            display: flex;
            background: white;
            padding: 24px;
            gap: 10px;
            overflow-x: visible;
            flex-wrap: wrap;
            justify-content: center;
            border-bottom: 2px solid var(--gray-100);
        }
        .tab {
            flex: 0 0 auto;
            padding: 14px 20px;
            text-align: center;
            cursor: pointer;
            border: 3px solid var(--gray-200);
            background: white;
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-500);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            min-width: 130px;
            max-width: 180px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .tab:hover:not(.active) {
            background: var(--gray-50);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.15);
        }
        .tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }
        .tab .tab-icon {
            display: block;
            font-size: 32px;
            margin-bottom: 10px;
        }
        .tab .tab-label {
            display: block;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .tab-content {
            display: none;
            padding: 40px;
        }
        .tab-content.active { 
            display: block;
            animation: slideInFromRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* TAB GUIDANCE */
        .tab-guidance {
            background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
            border: 3px solid var(--primary);
            border-radius: 16px;
            padding: 28px 32px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15);
        }
        .tab-guidance-title {
            font-size: 19px;
            font-weight: 800;
            color: #1e40af;
            margin-bottom: 14px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }
        .tab-guidance-text {
            color: #1e3a8a;
            font-size: 16px;
            line-height: 1.8;
            font-weight: 500;
        }

        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 24px;
            padding-bottom: 14px;
            border-bottom: 4px solid var(--primary);
        }

        /* HELP TOOLTIP SYSTEM */
        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            font-size: 13px;
            font-weight: 800;
            cursor: help;
            margin-left: 8px;
            position: relative;
            transition: all 0.3s;
            animation: float 3s ease-in-out infinite;
        }
        .help-icon::before {
            content: '?';
        }
        .help-icon:hover {
            background: var(--primary-dark);
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .tooltip {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-800);
            color: white;
            padding: 14px 18px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.6;
            width: 300px;
            max-width: calc(100vw - 40px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .help-icon:hover .tooltip {
            opacity: 1;
        }
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--gray-800);
        }

        /* FORM FIELDS */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 35px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .form-group label {
            font-size: 15px;
            font-weight: 700;
            color: var(--gray-700);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .required {
            color: var(--error);
            margin-left: 4px;
            font-size: 18px;
        }
        .form-group input,
        .form-group select {
            padding: 14px 18px;
            font-size: 16px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            transition: all 0.3s;
            font-family: 'Outfit', sans-serif;
            background: white;
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        .form-group.valid input,
        .form-group.valid select {
            border-color: var(--success);
            background: #f0fdf4;
            padding-right: 50px;
        }
        .form-group.error input,
        .form-group.error select {
            border-color: var(--error);
            background: #fef2f2;
        }
        .validation-icon {
            position: absolute;
            right: 16px;
            bottom: 16px;
            font-size: 22px;
        }
        .form-group.valid .validation-icon {
            animation: checkPop 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .help-text {
            font-size: 13px;
            color: var(--gray-500);
            margin-top: 8px;
            line-height: 1.5;
            display: flex;
            align-items: flex-start;
            gap: 6px;
        }
        .help-text svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .error-text {
            font-size: 13px;
            color: var(--error);
            margin-top: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* BUTTONS */
        .btn {
            padding: 16px 32px;
            font-size: 17px;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-family: 'Outfit', sans-serif;
            min-width: 140px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #1d4ed8 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 3px solid var(--primary);
        }
        .btn-secondary:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 25px;
            justify-content: flex-start;
        }
        .button-group .btn {
            flex: 1 1 auto;
            min-width: 160px;
            max-width: 100%;
        }

        /* EXAMPLE DATA TOGGLE */
        .example-toggle {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 3px solid var(--success);
            border-radius: 12px;
            padding: 18px 22px;
            margin-bottom: 28px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        .example-text {
            font-size: 15px;
            font-weight: 600;
            color: #065f46;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            flex: 1;
            min-width: 300px;
        }
        .example-text svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .btn-example {
            padding: 10px 20px;
            font-size: 15px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        .btn-example:hover {
            background: var(--success-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* AUTO-SAVE INDICATOR */
        .autosave-indicator {
            position: fixed;
            bottom: 35px;
            right: 35px;
            background: white;
            padding: 14px 24px;
            border-radius: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
            font-weight: 700;
            color: var(--success);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        .autosave-indicator.show {
            opacity: 1;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .autosave-indicator svg {
            width: 20px;
            height: 20px;
        }

        /* FAQ ACCORDION */
        .faq-section {
            margin-top: 50px;
            border-top: 3px solid var(--gray-200);
            padding-top: 35px;
        }
        .faq-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .faq-item {
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 14px;
            overflow: hidden;
            transition: all 0.3s;
        }
        .faq-item:hover {
            border-color: var(--primary);
        }
        .faq-question {
            padding: 18px 24px;
            background: var(--gray-50);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            font-size: 16px;
            color: var(--gray-700);
            transition: all 0.2s;
        }
        .faq-question:hover {
            background: var(--gray-100);
        }
        .faq-item.open .faq-question {
            background: var(--primary);
            color: white;
        }
        .faq-icon {
            transition: transform 0.3s;
            font-size: 14px;
            font-weight: 700;
        }
        .faq-item.open .faq-icon {
            transform: rotate(180deg);
        }
        .faq-answer {
            max-height: 0;
            overflow: hidden;
            display: none;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 24px;
        }
        .faq-item.open .faq-answer {
            display: block;
            max-height: 800px;
            padding: 20px 24px;
        }
        .faq-answer p {
            color: var(--gray-700);
            line-height: 1.7;
            font-size: 15px;
        }

        /* COMPLETION CELEBRATION */
        .celebration {
            display: none;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 4px solid var(--warning);
            border-radius: 16px;
            padding: 40px;
            margin: 35px 0;
            text-align: center;
            animation: celebration 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .celebration.show { display: block; }
        @keyframes celebration {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        .celebration-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .celebration-title {
            font-size: 32px;
            font-weight: 900;
            color: #92400e;
            margin-bottom: 16px;
        }
        .celebration-text {
            font-size: 18px;
            color: #78350f;
            line-height: 1.7;
            max-width: 700px;
            margin: 0 auto;
        }

        /* NEXT STEPS CHECKLIST */
        .next-steps {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 3px solid var(--primary);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
        }
        .next-steps-title {
            font-size: 24px;
            font-weight: 800;
            color: #1e40af;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .next-steps-title svg {
            width: 28px;
            height: 28px;
        }
        .next-step-item {
            display: flex;
            gap: 18px;
            margin-bottom: 20px;
            padding: 18px;
            background: white;
            border-radius: 12px;
            border-left: 5px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .next-step-number {
            background: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            min-width: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        .next-step-text {
            font-size: 16px;
            color: #1e40af;
            font-weight: 500;
            line-height: 1.7;
        }
        .next-step-text strong {
            color: #1e3a8a;
            font-weight: 800;
        }

        /* OUTPUT BOX */
        .output-box {
            display: none;
            margin-top: 30px;
            border: 3px solid var(--gray-200);
            border-radius: 16px;
            padding: 30px;
            background: var(--gray-50);
        }
        .output-box h3 {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--gray-900);
        }
        .output-text {
            background: white;
            padding: 24px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 2px solid var(--gray-200);
            max-height: 600px;
            overflow-y: auto;
        }

        /* STICKY CTA */
        .sticky-cta {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 16px 20px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            display: none;
            z-index: 999;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.3s, transform 0.3s;
        }
        .sticky-cta.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .sticky-cta-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        .sticky-cta-text {
            font-size: 16px;
            font-weight: 700;
            color: var(--gray-900);
        }

        /* FOOTER */
        .footer {
            background: var(--gray-800);
            color: white;
            padding: 40px 20px;
            margin-top: 60px;
        }
        
        /* TOAST NOTIFICATIONS */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: white;
            padding: 14px 28px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 15px;
            z-index: 10000;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
            animation: slideUpToast 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toast.error {
            background: #ef4444;
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
        }
        
        .toast.info {
            background: #3b82f6;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
        }
        
        @keyframes slideUpToast {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        @keyframes fadeOutToast {
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
        }
        
        /* LOADING SPINNER */
        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* SWIPE HINT (Mobile Only) */
        .swipe-hint {
            position: fixed;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(59, 130, 246, 0.95);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            z-index: 9999;
            display: none;
            animation: slideUpToast 0.5s ease-out, fadeOutToast 0.5s 3.5s ease-out;
            pointer-events: none;
        }
        .swipe-hint.show {
            display: block;
        }
        @media (min-width: 769px) {
            .swipe-hint { display: none !important; }
        }
        
        /* FLOATING PROGRESS INDICATOR (Tablet & Mobile Only) */
        .floating-progress-badge {
            display: none; /* Hidden on desktop */
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 50%;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
            cursor: pointer;
            z-index: 998;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 3px solid white;
        }
        .floating-progress-badge:active {
            transform: scale(0.95);
        }
        .floating-progress-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }
        .floating-progress-badge .badge-text {
            font-size: 16px;
            line-height: 1;
        }
        .floating-progress-badge .badge-label {
            font-size: 10px;
            margin-top: 2px;
            opacity: 0.9;
        }
        
        /* Floating Progress Panel (Slide-up) */
        .floating-progress-panel {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 999;
            max-height: 70vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 24px;
        }
        .floating-progress-panel.open {
            display: block;
            transform: translateY(0);
        }
        .floating-progress-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-200);
        }
        .floating-progress-panel-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--gray-900);
        }
        .floating-progress-panel-close {
            background: var(--gray-200);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--gray-600);
            transition: all 0.2s;
        }
        .floating-progress-panel-close:hover {
            background: var(--gray-300);
            transform: rotate(90deg);
        }
        
        /* Panel Backdrop */
        .floating-progress-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .floating-progress-backdrop.show {
            display: block;
            opacity: 1;
        }
        
        /* Show floating progress on tablet/mobile, hide on desktop */
        @media (max-width: 1400px) {
            .floating-progress-badge {
                display: flex;
            }
        }
        @media (min-width: 1201px) {
            .floating-progress-badge,
            .floating-progress-panel,
            .floating-progress-backdrop {
                display: none !important;
            }
        }
        
        /* VOICE INPUT BUTTON */
        .voice-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            color: var(--gray-500);
            transition: all 0.3s;
            border-radius: 6px;
            display: none; /* Hidden by default, shown if supported */
        }
        .voice-btn:hover {
            background: var(--gray-100);
            color: var(--primary);
        }
        .voice-btn.listening {
            color: var(--danger);
            animation: pulse 1.5s infinite;
        }
        .voice-btn svg {
            width: 20px;
            height: 20px;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* COPY ALL BUTTON */
        .copy-all-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            width: 100%;
            display: flex;
        }
        .copy-all-btn:hover {
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }
        
        
        /* TOAST NOTIFICATIONS */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            z-index: 10001;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideUpToast 0.3s ease-out;
        }
        .toast.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
        }
        .toast svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        @keyframes slideUpToast {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        .toast.fade-out {
            animation: fadeOutToast 0.3s ease-out forwards;
        }
        @keyframes fadeOutToast {
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
        }

        /* LOADING SPINNER */
        .spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        /* PREMIUM BADGE SHIMMER */
        .premium-badge {
            position: relative;
            overflow: hidden;
        }
        .premium-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 3s infinite;
            animation-delay: 1s;
        }
        
        /* PREMIUM CTA BUTTONS WITH GLOW */
        .premium-cta-btn {
            animation: glow 2s ease-in-out infinite;
        }
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 35px;
        }
        .footer-text {
            font-size: 14px;
            color: var(--gray-300);
            margin-bottom: 6px;
            line-height: 1.6;
        }
        .footer-disclaimer {
            margin-top: 18px;
            font-size: 12px;
            color: var(--gray-400);
            max-width: 900px;
            line-height: 1.6;
        }

        /* CONTENT BOXES */
        .info-box {
            background: var(--gray-50);
            padding: 24px;
            border-radius: 12px;
            border-left: 5px solid var(--primary);
            margin-bottom: 28px;
        }
        .info-box h3 {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 14px;
            color: var(--gray-900);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        .info-box h3:hover {
            color: var(--primary);
        }
        .info-box-icon {
            transition: transform 0.3s;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
        }
        .info-box.open .info-box-icon {
            transform: rotate(180deg);
        }
        .info-box-content {
            max-height: 0;
            overflow: hidden;
            display: none;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .info-box.open .info-box-content {
            display: block;
            max-height: 1000px;
        }
        .info-box p {
            color: var(--gray-700);
            line-height: 1.8;
            font-size: 15px;
        }

        /* STATE CARDS */
        .state-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }
        .state-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s;
            animation: fadeInUp 0.5s ease-out backwards;
        }
        .state-card:nth-child(1) { animation-delay: 0.05s; }
        .state-card:nth-child(2) { animation-delay: 0.1s; }
        .state-card:nth-child(3) { animation-delay: 0.15s; }
        .state-card:nth-child(4) { animation-delay: 0.2s; }
        .state-card:nth-child(5) { animation-delay: 0.25s; }
        .state-card:nth-child(6) { animation-delay: 0.3s; }
        .state-card:nth-child(7) { animation-delay: 0.35s; }
        .state-card:nth-child(8) { animation-delay: 0.4s; }
        .state-card:hover {
            border-color: var(--primary);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.15);
            transform: translateY(-4px);
        }
        .state-card h3 {
            font-size: 20px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 12px;
        }
        .state-strength {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        .state-details {
            font-size: 14px;
            line-height: 1.7;
            color: var(--gray-700);
        }
        .state-details p {
            margin-bottom: 12px;
        }
        .state-details strong {
            color: var(--gray-900);
            font-weight: 700;
            display: block;
            margin-top: 14px;
        }

        #stateSearch {
            width: 100%;
            padding: 16px 20px;
            font-size: 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 28px;
            font-family: 'Outfit', sans-serif;
        }
        #stateSearch:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* RESPONSIVE */
        @media (max-width: 1400px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            .sidebar {
                position: static;
                order: -1;
                max-height: none;
                overflow-y: visible;
            }
        }
        
        /* Mobile: Sidebar at bottom, hide progress gauge */
        @media (max-width: 768px) {
            .sidebar {
                order: 1 !important; /* Move to bottom (after content) */
            }
            .progress-container {
                display: none !important; /* Hide percentage gauge on mobile */
            }
        }
        @media (max-width: 768px) {
            * {
                max-width: 100vw;
                box-sizing: border-box;
            }
            
            body {
                font-size: 14px;
                overflow-x: hidden;
                width: 100%;
            }
            
            /* Strict content wrapper control on mobile */
            .content {
                position: relative;
                overflow: visible;
                min-height: 100vh;
            }
            
            /* Ensure only active tab shows on mobile - use absolute positioning for complete isolation */
            .tab-content {
                display: none !important;
                position: absolute !important;
                top: 0;
                left: 0;
                right: 0;
                width: 100%;
                height: 0 !important;
                overflow: hidden !important;
                visibility: hidden !important;
                opacity: 0 !important;
                pointer-events: none !important;
                z-index: 1;
            }
            .tab-content.active {
                display: block !important;
                position: relative !important;
                height: auto !important;
                overflow: visible !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
                z-index: 10;
            }
            
            /* Hide sticky CTA by default on mobile (only show with .show class) */
            .sticky-cta {
                display: none !important;
            }
            .sticky-cta.show {
                display: block !important;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .title-section {
                min-width: 0 !important;
                width: 100%;
            }
            .title {
                font-size: 24px !important;
            }
            .tagline {
                font-size: 16px !important;
            }
            .features {
                justify-content: center;
                width: 100%;
            }
            .feature-badge {
                font-size: 12px !important;
                padding: 8px 14px !important;
            }
            .tier-banner-content {
                flex-direction: column;
            }
            .tier-name { font-size: 24px !important; }
            .tier-subtitle { font-size: 16px !important; }
            .tier-value-prop { font-size: 14px !important; }
            .banner-logo { height: 300px !important; }
            .progress-steps {
                flex-direction: column;
                gap: 15px;
            }
            .progress-line {
                display: none;
            }
            .tabs {
                padding: 12px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .tab {
                min-width: 120px !important;
                padding: 12px 16px !important;
                font-size: 14px !important;
            }
            .tab-content {
                padding: 20px 16px !important;
                width: 100%;
                margin: 0 auto;
            }
            .form-grid {
                display: grid !important;
                grid-template-columns: 1fr !important;
                gap: 16px !important;
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 auto !important;
                padding: 0 !important;
            }
            .form-group label {
                font-size: 14px !important;
                width: 100%;
                display: block;
            }
            .form-group input,
            .form-group select {
                font-size: 16px !important; /* Prevents iOS zoom */
                padding: 12px !important;
                width: 100%;
                box-sizing: border-box;
            }
            .form-group {
                width: 100%;
                margin: 0;
            }
            .button-group {
                flex-wrap: wrap;
                gap: 10px !important;
                width: 100% !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                justify-content: stretch;
            }
            .button-group .btn {
                flex: 1 1 calc(50% - 5px);
                min-width: 140px !important;
                max-width: 100%;
            }
            .btn {
                width: auto;
                min-width: auto !important;
                padding: 14px 20px !important;
                font-size: 15px !important;
            }
            .letter-cta-box {
                padding: 18px 14px !important;
                margin-top: 20px !important;
            }
            .letter-cta-title {
                font-size: 16px !important;
                margin-bottom: 10px !important;
            }
            .letter-cta-text {
                font-size: 14px !important;
                margin-bottom: 16px !important;
            }
            .letter-cta-button {
                padding: 14px 20px !important;
                font-size: 16px !important;
                width: 100% !important;
                display: block !important;
            }
            .letter-cta-subtext {
                font-size: 12px !important;
                margin-top: 8px !important;
            }
            
            /* Mobile optimization for all components */
            .main-container {
                padding: 0 16px !important;
                margin: 20px auto !important;
                max-width: 100% !important;
                width: 100%;
            }
            #content-info {
                display: block !important;
                padding: 20px 16px !important;
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                box-sizing: border-box !important;
                overflow-x: hidden !important;
                text-align: left !important;
            }
            #content-info > * {
                width: 100% !important;
                max-width: 100% !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                box-sizing: border-box !important;
            }
            .section-title {
                width: 100% !important;
                text-align: left;
                margin: 0 0 20px 0 !important;
                padding: 0 0 14px 0 !important;
            }
            .tab-guidance {
                width: 100% !important;
                margin: 0 0 20px 0 !important;
                padding: 18px 16px !important;
            }
            .tab-guidance-title,
            .tab-guidance-text {
                width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .tab-guidance-text {
                margin-top: 12px !important;
            }
            .example-toggle {
                width: 100% !important;
                margin: 0 0 20px 0 !important;
                padding: 16px !important;
                flex-direction: column !important;
            }
            .example-text {
                width: 100% !important;
                padding: 0 !important;
                margin: 0 0 12px 0 !important;
                min-width: 0 !important;
            }
            .btn-example {
                width: 100% !important;
                margin: 4px 0 !important;
            }
            .sidebar {
                padding: 16px !important;
            }
            .content {
                margin-bottom: 20px;
                width: 100%;
                margin-left: 0;
                margin-right: 0;
                overflow-x: hidden !important;
            }
            .celebration {
                padding: 18px 14px !important;
                border-radius: 8px !important;
            }
            .celebration-title {
                font-size: 18px !important;
            }
            .celebration-text {
                font-size: 14px !important;
            }
            .celebration-cta {
                padding: 14px 24px !important;
                font-size: 16px !important;
                width: 100% !important;
                display: block !important;
            }
            .next-steps {
                padding: 16px 12px !important;
            }
            .next-steps-title {
                font-size: 15px !important;
            }
            .next-step-item {
                padding: 12px !important;
                flex-direction: row !important;
                align-items: flex-start !important;
                gap: 12px !important;
            }
            .next-step-number {
                margin-bottom: 0 !important;
                flex-shrink: 0;
            }
            .next-step-text {
                font-size: 13px !important;
                line-height: 1.5 !important;
            }
            .state-card {
                padding: 12px !important;
                min-width: 0 !important;
            }
            .state-card h3 {
                font-size: 16px !important;
            }
            .state-grid {
                grid-template-columns: 1fr !important;
                gap: 16px !important;
            }
            .faq-question {
                font-size: 14px !important;
                padding: 12px !important;
            }
            .faq-answer {
                font-size: 13px !important;
                padding: 12px !important;
            }
            .prep-checklist {
                padding: 14px 12px !important;
                margin: 15px auto !important;
            }
            .prep-title {
                font-size: 14px !important;
            }
            .prep-item {
                padding: 8px !important;
                font-size: 13px !important;
            }
            .output-box {
                padding: 16px 12px !important;
            }
            .output-text {
                font-size: 13px !important;
                padding: 12px !important;
                line-height: 1.6 !important;
            }
            .section-title {
                font-size: 22px !important;
            }
            .tab-guidance {
                padding: 14px 12px !important;
            }
            .tab-guidance-title {
                font-size: 15px !important;
            }
            .tab-guidance-text {
                font-size: 13px !important;
            }
            .premium-upsell-box {
                padding: 16px 12px !important;
                margin: 16px 0 !important;
            }
            .premium-upsell-title {
                font-size: 15px !important;
            }
            .premium-upsell-text {
                font-size: 13px !important;
            }
            .premium-features {
                gap: 8px !important;
            }
            .premium-feature-card {
                flex: 1 1 100% !important;
                min-width: 0 !important;
                padding: 10px !important;
            }
            .premium-feature-card div {
                font-size: 12px !important;
            }
            .premium-upsell-button {
                padding: 12px 20px !important;
                font-size: 14px !important;
                display: block !important;
                width: 100% !important;
            }
            
            /* Fixed position elements on mobile */
            .autosave-indicator {
                bottom: 20px !important;
                right: 12px !important;
                padding: 10px 16px !important;
                font-size: 13px !important;
            }
            .sticky-cta {
                padding: 12px 16px !important;
            }
            .sticky-cta-inner {
                flex-direction: column;
                gap: 12px !important;
                align-items: stretch !important;
            }
            .sticky-cta-text {
                font-size: 14px !important;
                text-align: center;
            }
            .sticky-cta .btn {
                width: 100% !important;
            }
            
            /* Override inline padding for CTA boxes */
            div[style*="padding: 32px"],
            div[style*="padding: 40px"] {
                padding: 20px 16px !important;
            }
            
            /* Fix example text area */
            .example-text {
                min-width: 0 !important;
            }
        }
        
        /* Extra small screens (small phones) */
        @media (max-width: 400px) {
            .title {
                font-size: 20px !important;
            }
            .tagline {
                font-size: 14px !important;
            }
            .tier-name {
                font-size: 20px !important;
            }
            .tab {
                min-width: 100px !important;
                padding: 10px 12px !important;
                font-size: 13px !important;
            }
            .prep-checklist {
                padding: 12px 10px !important;
            }
            .main-container {
                padding: 0 12px !important;
            }
            .section-title {
                font-size: 20px !important;
            }
            .tab-content {
                padding: 18px 14px !important;
            }
        }
        
        /* TABLET OPTIMIZATION (iPad Portrait, Android Tablets) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .main-container {
                max-width: 900px;
                padding: 0 24px;
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 16px;
                padding: 20px;
                margin-bottom: 24px;
            }
            
            .sidebar-title {
                grid-column: 1 / -1;
                margin-bottom: 0;
            }
            
            .step {
                margin-bottom: 8px;
            }
            
            .form-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 20px;
            }
            
            .btn {
                width: auto !important;
                min-width: 200px;
                min-height: 48px;
                padding: 14px 32px;
            }
            
            .button-group {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
            }
            
            .button-group .btn {
                flex: 1;
                min-width: 180px;
            }
            
            .tab {
                min-height: 56px;
                padding: 12px 20px;
                font-size: 15px;
            }
            
            .state-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            .prep-checklist {
                padding: 20px;
            }
            
            .section-title {
                font-size: 26px;
            }
        }
        
        /* Print optimization */
        @media print {
            .sidebar,
            .tabs,
            .prep-checklist,
            .btn,
            .button-group,
            .tier-banner,
            .progress-container,
            .sticky-cta,
            .autosave-indicator,
            .swipe-hint,
            .toast,
            .tab-guidance,
            .faq-section,
            .premium-upsell-box,
            .letter-cta-box,
            .celebration-box {
                display: none !important;
            }
            
            .tab-content {
                display: block !important;
                page-break-inside: avoid;
            }
            
            .main-container {
                max-width: 100%;
                padding: 0;
                grid-template-columns: 1fr;
            }
            body {
                font-size: 12pt;
                color: black;
                background: white;
            }
            
            .output-box {
                border: 1px solid #000;
                padding: 20px;
                page-break-inside: avoid;
            }
            
            .next-steps {
                page-break-before: always;
            }
            
            h2, h3 {
                page-break-after: avoid;
            }
        }
        
        /* DARK MODE SUPPORT */
        @media (prefers-color-scheme: dark) {
            body.dark-mode {
                --gray-50: #18181b;
                --gray-100: #27272a;
                --gray-200: #3f3f46;
                --gray-300: #52525b;
                --gray-400: #71717a;
                --gray-500: #a1a1aa;
                --gray-600: #d4d4d8;
                --gray-700: #e4e4e7;
                --gray-800: #27272a;
                --gray-900: #18181b;
                background: #0a0a0a;
                color: #e4e4e7;
            }
            
            body.dark-mode .tier-banner {
                background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            }
            
            body.dark-mode .tab {
                background: var(--gray-800);
                color: var(--gray-300);
                border-color: var(--gray-700);
            }
            
            body.dark-mode .tab.active {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                color: white;
            }
            
            body.dark-mode .sidebar {
                background: var(--gray-900);
                border-color: var(--gray-700);
            }
            
            body.dark-mode .form-group input,
            body.dark-mode .form-group select {
                background: var(--gray-800);
                color: var(--gray-100);
                border-color: var(--gray-600);
            }
            
            body.dark-mode .output-box {
                background: var(--gray-900);
                border-color: var(--gray-700);
            }
            
            body.dark-mode .state-card {
                background: var(--gray-800);
                border-color: var(--gray-700);
            }
            
            body.dark-mode .toast {
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            }
        }
        
        /* SESSION TIMEOUT WARNING */
        .session-warning {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(245, 158, 11, 0.4);
            z-index: 9998;
            display: none;
            animation: slideInRight 0.3s ease-out;
            max-width: 350px;
        }
        
        .session-warning.show {
            display: block;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* HELP SHORTCUTS OVERLAY */
        .shortcuts-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        .shortcuts-overlay.show {
            display: flex;
        }
        
        .shortcuts-panel {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-mode .shortcuts-panel {
            background: var(--gray-800);
            color: var(--gray-100);
        }
        
        .shortcut-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }
        
        body.dark-mode .shortcut-row {
            border-bottom-color: var(--gray-600);
        }
        
        .shortcut-key {
            background: var(--gray-100);
            padding: 4px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: 600;
        }
        
        body.dark-mode .shortcut-key {
            background: var(--gray-700);
        }
        
        
        /* ============================================
           MOBILE ENHANCEMENT FEATURES
           ============================================ */
        
        /* VOICE INPUT BUTTON */
        .voice-input-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: none; /* Hidden by default, shown only on mobile with speech support */
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
            z-index: 10;
        }
        .voice-input-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }
        .voice-input-btn:active {
            transform: translateY(-50%) scale(0.95);
        }
        .voice-input-btn.listening {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse 1.5s ease-in-out infinite;
        }
        .voice-input-btn svg {
            width: 18px;
            height: 18px;
            color: white;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* SWIPE INDICATOR */
        .swipe-indicator {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(59, 130, 246, 0.95);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .swipe-indicator.left {
            left: 20px;
        }
        .swipe-indicator.right {
            right: 20px;
        }
        .swipe-indicator.show {
            opacity: 1;
        }
        
        /* FORM GROUP WITH VOICE */
        .form-group.with-voice input {
            padding-right: 56px !important;
        }
        
        /* BUTTON LOADING STATE */
        .btn.loading {
            position: relative;
            pointer-events: none;
            color: transparent !important;
        }
        .btn.loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        /* VALIDATION ERROR HIGHLIGHT */
        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        .form-group.error label {
            color: #ef4444 !important;
        }
        
        /* CONFETTI ANIMATION */
        #confettiCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
    </style>
</head>
<body>
    
    <!-- CONFETTI CANVAS -->
    <canvas id="confettiCanvas"></canvas>
    
    <!-- FLOATING PROGRESS INDICATOR (Tablet/Mobile Only) -->
    <div class="floating-progress-badge" id="floatingProgressBadge" onclick="toggleFloatingProgress()">
        <div class="badge-text" id="floatingProgressText">1/6</div>
        <div class="badge-label">Step</div>
    </div>
    
    <!-- Progress Panel Backdrop -->
    <div class="floating-progress-backdrop" id="floatingProgressBackdrop" onclick="closeFloatingProgress()"></div>
    
    
    <!-- ESTIMATED TIME BANNER -->
    <!-- TIER BANNER -->
    <div class="tier-banner">
        <div class="tier-banner-content">
            <div class="tier-badge">★ PROFESSIONAL TIER ★</div>
            <img src="https://myfairclaim.github.io/logo.png" alt="MyFairClaim Logo" class="banner-logo">
            <div class="banner-text">
                <div class="tier-name">Fair Claim Submission Playbook™</div>
                <div class="tier-subtitle">Part of Your MyFairClaim Professional Report</div>
                <div class="tier-value-prop">Professional-grade documentation tools designed to help you file your claim with confidence. Generate demand letters and email templates backed by our expert appraisal reports.</div>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <div class="header">
        <div class="header-content">
            <div class="title-section">
                <h1 class="title">Professional Claim Filing Tool</h1>
                <p class="tagline">"They fixed the car. Not the history. You shouldn't pay the difference."</p>
                <p style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 4px; font-weight: 400;">Fair Claim Submission Playbook™ is a trademark of MyFairClaim LLC. All rights reserved.</p>
            </div>
            <div class="features">
                <span class="feature-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    <span>Live Legal Citations</span>
                </span>
                <span class="feature-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                    </svg>
                    <span>50-State Coverage</span>
                </span>
                <span class="feature-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>Document Generator</span>
                </span>
            </div>
        </div>
    </div>

    <!-- PROGRESS INDICATOR -->
    <div class="progress-container">
        <div class="progress-inner">
            <div class="progress-steps">
                <div class="progress-line">
                    <div class="progress-line-fill" id="progressFill"></div>
                </div>
                <div class="progress-step active" data-step="1">
                    <div class="progress-step-circle">1</div>
                    <div class="progress-step-label">Learn</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="progress-step-circle">2</div>
                    <div class="progress-step-label">Review Laws</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="progress-step-circle">3</div>
                    <div class="progress-step-label">Enter Info</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="progress-step-circle">4</div>
                    <div class="progress-step-label">Generate Letter</div>
                </div>
                <div class="progress-step" data-step="5">
                    <div class="progress-step-circle">5</div>
                    <div class="progress-step-label">Send Email</div>
                </div>
                <div class="progress-step" data-step="6">
                    <div class="progress-step-circle">6</div>
                    <div class="progress-step-label">Complete</div>
                </div>
            </div>
            <div class="progress-percentage" id="progressPercentage">Step 1 of 6 - 0% Complete</div>
        </div>
    </div>

    <!-- PREPARATION CHECKLIST -->
    <div class="prep-checklist" id="prepChecklist">
        <div class="prep-title">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            <span>Gather These Items Before You Begin (5 minutes):</span>
            <button class="prep-minimize-btn" onclick="minimizeChecklist()" title="Minimize checklist">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
        </div>
        <div class="prep-items-container" id="prepItemsContainer">
            <div class="prep-item" onclick="toggleCheckbox(this)">
                <div class="prep-checkbox"></div>
                <div class="prep-text">Your MyFairClaim reports (Fair Market Impact Report & Fair Market Value Report)</div>
            </div>
            <div class="prep-item" onclick="toggleCheckbox(this)">
                <div class="prep-checkbox"></div>
                <div class="prep-text">Vehicle information (Year, Make, Model, VIN)</div>
            </div>
            <div class="prep-item" onclick="toggleCheckbox(this)">
                <div class="prep-checkbox"></div>
                <div class="prep-text">Insurance claim paperwork (Policy #, Claim #)</div>
            </div>
            <div class="prep-item" onclick="toggleCheckbox(this)">
                <div class="prep-checkbox"></div>
                <div class="prep-text">Your contact information (Name, Email, Phone, Address)</div>
            </div>
            <div class="prep-item" onclick="toggleCheckbox(this)">
                <div class="prep-checkbox"></div>
                <div class="prep-text">10 minutes of uninterrupted time to complete the form</div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTAINER (2-column grid: Content + Sidebar) -->
    <div class="main-container">
        <!-- CONTENT AREA -->
        <div class="content">
            <!-- NAVIGATION TABS -->
            <div class="tabs">
                <button class="tab active" id="tab-guide" onclick="switchTab('guide', 1)">
                    <span class="tab-icon">📋</span>
                    <span class="tab-label">Filing Guide</span>
                </button>
                <button class="tab" id="tab-laws" onclick="switchTabAndScroll('laws', 2, 'section-laws')">
                    <span class="tab-icon">⚖️</span>
                    <span class="tab-label">State Law Database</span>
                </button>
                <button class="tab" id="tab-info" onclick="switchTabAndScroll('info', 3, 'section-info')">
                    <span class="tab-icon">✏️</span>
                    <span class="tab-label">Your Information</span>
                </button>
                <button class="tab" id="tab-letter" onclick="switchTab('letter', 4)">
                    <span class="tab-icon">📄</span>
                    <span class="tab-label">Generate Letter</span>
                </button>
                <button class="tab" id="tab-email" onclick="switchTabAndScroll('email', 5, 'section-email')">
                    <span class="tab-icon">✉️</span>
                    <span class="tab-label">Generate Email</span>
                </button>
                <button class="tab" id="tab-complete" onclick="switchTabAndScroll('complete', 6, 'section-complete')">
                    <span class="tab-icon">🎊</span>
                    <span class="tab-label">Complete Package</span>
                </button>
            </div>

            <!-- TAB CONTENT: FILING GUIDE -->
            <div id="content-guide" class="tab-content active">
                <h2 class="section-title">📋 Fair Claim Submission Playbook™</h2>
                <div class="tab-guidance">
                    <div class="tab-guidance-title">📖 Start Here First</div>
                    <div class="tab-guidance-text">
                        <strong>Read this before doing anything else.</strong> This guide explains what diminished value (DV) is, how much you can recover, and the step-by-step process to file your claim. Understanding these fundamentals will help you navigate the claims process confidently and know exactly what to expect at each stage.
                    </div>
                </div>

                <div class="info-box" onclick="toggleInfoBox(this)">
                    <h3>🎯 What Is Diminished Value (DV)? <span class="info-box-icon">▼</span></h3>
                    <div class="info-box-content">
                        <p>Even after professional repairs, your vehicle loses market value due to its accident history. This is called <strong>diminished value</strong>, and you have the legal right to recover it from the at-fault party's insurance company. A car with an accident record typically loses 10-25% of its resale value, even if repairs are perfect.</p>
                    </div>
                </div>

                <div class="info-box" onclick="toggleInfoBox(this)">
                    <h3>💰 How Much Is Your Claim Worth? <span class="info-box-icon">▼</span></h3>
                    <div class="info-box-content">
                        <p>Your MyFairClaim Fair Market Impact Report calculated your specific diminished value using pre-accident fair market value, repair costs and severity, vehicle age/mileage/condition, state-specific legal precedents, and current market trends. Your calculated amount is scientifically defensible and legally supported.</p>
                    </div>
                </div>

                <div class="info-box" onclick="toggleInfoBox(this)">
                    <h3>📝 How to File Your Claim <span class="info-box-icon">▼</span></h3>
                    <div class="info-box-content">
                        <p><strong>Step 1:</strong> Review state-specific laws in "State Law Database" tab • <strong>Step 2:</strong> Complete "Your Information" tab • <strong>Step 3:</strong> Generate demand letter in "Generate Letter" tab • <strong>Step 4:</strong> Send via certified mail with your MyFairClaim reports attached • <strong>Step 5:</strong> Use "Generate Email" tab for follow-ups</p>
                    </div>
                </div>

                <div class="info-box" onclick="toggleInfoBox(this)">
                    <h3>⚖️ Your Legal Rights <span class="info-box-icon">▼</span></h3>
                    <div class="info-box-content">
                        <p>In all 50 states plus DC, you have the right to claim diminished value as part of property damage. Insurance companies must acknowledge your claim within legally required timeframes, investigate in good faith, pay valid claims promptly, and provide written reasons for any denial. <strong>Pro Tip:</strong> State response deadlines vary from 15-60 days—check your state's requirements in the database.</p>
                    </div>
                </div>

                <div class="info-box" onclick="toggleInfoBox(this)">
                    <h3>🛡️ What If They Deny or Delay? <span class="info-box-icon">▼</span></h3>
                    <div class="info-box-content">
                        <p>Insurance companies often deny or delay valid diminished value claims, hoping you'll give up. <strong>Don't.</strong> You have powerful escalation options: file a complaint with your state's Department of Insurance, request mediation or appraisal under policy provisions, consult with an attorney for bad faith litigation, or pursue small claims court (typically for claims under $5,000-$10,000 depending on state).</p>
                    </div>
                </div>

                <!-- FAQ Section -->
                <div class="faq-section">
                    <div class="faq-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 28px; height: 28px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Common Questions
                    </div>
                    
                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>What if I don't have my policy number yet?</span>
                            <span class="faq-icon">▼</span>
                        </div>
                        <div class="faq-answer">
                            <p>No problem! Policy number and claim number are optional fields. You can still generate your demand letter without them. However, including these numbers helps the insurance company route your claim faster. You can find these on your insurance card, claim paperwork, or by calling your insurance company.</p>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Can I file this claim myself or do I need a lawyer?</span>
                            <span class="faq-icon">▼</span>
                        </div>
                        <div class="faq-answer">
                            <p>You absolutely can file this yourself! That's exactly what this tool helps you do. Your MyFairClaim reports provide professional documentation, and our demand letter includes all the legal citations you need. Most people successfully recover their DV amount without a lawyer. If the insurance company continues to deny your claim, you can always consult an attorney later.</p>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>How long does this process take?</span>
                            <span class="faq-icon">▼</span>
                        </div>
                        <div class="faq-answer">
                            <p>Filling out this form takes 5-10 minutes. After you mail your demand letter, insurance companies are legally required to respond within 15-60 days depending on your state (check the State Law Database for your specific timeframe). Most claims are resolved within 30-45 days of mailing the letter.</p>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>What if the insurance company denies my claim?</span>
                            <span class="faq-icon">▼</span>
                        </div>
                        <div class="faq-answer">
                            <p>If your claim is denied, request a detailed written explanation. Then consider: (1) Filing a complaint with your state's Department of Insurance, (2) Requesting an independent appraisal, (3) <a href="https://www.myfairclaim.com/pricing" target="_blank" rel="noopener noreferrer" style="color: #2563eb; font-weight: 600; text-decoration: none;">Upgrading to Premium</a> for advanced rebuttal letter templates and negotiation strategies, or (4) Consulting with an attorney. Your MyFairClaim reports strengthen your position in any of these scenarios.</p>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Where do I find my VIN?</span>
                            <span class="faq-icon">▼</span>
                        </div>
                        <div class="faq-answer">
                            <p>Your VIN (Vehicle Identification Number) is a 17-character code found in three places: (1) On your dashboard, visible through the windshield on the driver's side, (2) On the driver's side door frame, or (3) On your insurance card or vehicle registration. It's a mix of numbers and letters.</p>
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Do I need to send the demand letter via certified mail?</span>
                            <span class="faq-icon">▼</span>
                        </div>
                        <div class="faq-answer">
                            <p>Yes, absolutely! Certified mail with return receipt provides legal proof that you sent the letter and that the insurance company received it. This is crucial if you need to escalate your claim. It costs about $8 at the post office and gives you a tracking number plus a signed receipt when they receive it.</p>
                        </div>
                    </div>
                </div>
                
                <!-- CTA to Next Step -->
                <div style="text-align: center; margin-top: 40px; padding: 32px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #3b82f6; border-radius: 12px;">
                    <div style="font-size: 18px; font-weight: 700; color: #1e40af; margin-bottom: 12px;">✅ Ready to Review Your State's Laws?</div>
                    <div style="font-size: 15px; color: #1e3a8a; margin-bottom: 24px; font-weight: 500;">You now understand your rights and the claims process. Let's review the specific legal citations that apply to your claim.</div>
                    <button onclick="switchTabAndScroll('laws', 2, 'section-laws')" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 16px 40px; border: none; border-radius: 10px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.3s; font-family: 'Outfit', sans-serif; animation: glow 2s ease-in-out infinite;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)';">
                        ⚖️ Continue to Step 2: Review State Laws
                    </button>
                    <div style="margin-top: 10px; font-size: 13px; color: #64748b; font-weight: 500;">See the exact legal citations that will strengthen your claim</div>
                </div>
            </div>

            <!-- TAB CONTENT: STATE LAW DATABASE -->
            <div id="content-laws" class="tab-content">
                <h2 class="section-title" id="section-laws">⚖️ State Law Database</h2>
                <div class="tab-guidance">
                    <div class="tab-guidance-title">🔍 Find Your State's Laws</div>
                    <div class="tab-guidance-text">
                        <strong>Search for your state below.</strong> Review the legal foundation for your claim including case law, statutes, response deadlines, and filing tips. This information will be automatically included in your demand letter and email — understanding it helps you speak confidently with insurance adjusters and know your rights. <span style="display: inline-block; margin-top: 8px; padding: 8px 12px; background: rgba(255, 255, 255, 0.7); border-radius: 6px; font-size: 14px;"><a href="https://www.myfairclaim.com/pricing" target="_blank" rel="noopener noreferrer" style="color: #1e40af; font-weight: 600; text-decoration: none;">Premium members</a> get deeper legal research packages with precedent analysis for their specific state.</span>
                    </div>
                </div>
                
                <select id="stateSearch" onchange="filterStatesByDropdown(this.value)" style="width: 100%; padding: 16px; font-size: 16px; border: 2px solid #e5e7eb; border-radius: 12px; background: white; font-family: 'Outfit', sans-serif; margin-bottom: 20px; cursor: pointer;">
                    <option value="">🔍 Select your state...</option>
                </select>
                
                <div id="stateLawGrid" class="state-grid"></div>
                
                <!-- CTA to Next Step -->
                <div style="text-align: center; margin-top: 40px; padding: 32px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #3b82f6; border-radius: 12px;">
                    <div style="font-size: 18px; font-weight: 700; color: #1e40af; margin-bottom: 12px;">⚖️ Know Your Legal Rights?</div>
                    <div style="font-size: 15px; color: #1e3a8a; margin-bottom: 24px; font-weight: 500;">Now that you understand your state's laws and response deadlines, let's build your claim with your specific information.</div>
                    <button onclick="switchTabAndScroll('info', 3, 'section-info')" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 16px 40px; border: none; border-radius: 10px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.3s; font-family: 'Outfit', sans-serif; animation: glow 2s ease-in-out infinite;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)';">
                        ✏️ Continue to Step 3: Complete Your Information
                    </button>
                    <div style="margin-top: 10px; font-size: 13px; color: #64748b; font-weight: 500;">Your state's laws will automatically be included in your documents</div>
                </div>
            </div>

            <!-- TAB CONTENT: YOUR INFORMATION -->
            <div id="content-info" class="tab-content">
                <h2 class="section-title" id="section-info">✏️ Your Information</h2>
                <div class="tab-guidance">
                    <div class="tab-guidance-title">✅ Complete Required Fields</div>
                    <div class="tab-guidance-text">
                        <strong>Fill in all fields marked with <span style="color: #ef4444;">*</span> below.</strong> This information will automatically populate your demand letter and email templates. Make sure your diminished value amount matches your Fair Market Impact Report exactly. Double-check all details for accuracy before clicking "Save My Information" to proceed to document generation.
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group" data-field="fullName">
                        <label>
                            Full Name <span class="required">*</span>
                            <span class="help-icon">
                                <span class="tooltip">Your full legal name as it appears on official documents. This will appear on your demand letter.</span>
                            </span>
                        </label>
                        <input type="text" id="fullName" placeholder="John Smith" oninput="validateField(this)" onblur="autoSave()">
                        <span class="validation-icon"></span>
                    </div>
                    
                    <div class="form-group" data-field="email">
                        <label>
                            Email Address <span class="required">*</span>
                            <span class="help-icon">
                                <span class="tooltip">Your email address for insurance company correspondence. Make sure it's an address you check regularly.</span>
                            </span>
                        </label>
                        <input type="email" id="email" inputmode="email" placeholder="john@email.com" oninput="validateField(this)" onblur="autoSave()">
                        <span class="validation-icon"></span>
                    </div>
                    
                    <div class="form-group" data-field="phone">
                        <label>
                            Phone Number <span class="required">*</span>
                            <span class="help-icon">
                                <span class="tooltip">Your primary contact number. The insurance adjuster may call you at this number.</span>
                            </span>
                        </label>
                        <input type="tel" id="phone" inputmode="tel" placeholder="(555) 123-4567" oninput="formatPhone(this); validateField(this);" onblur="autoSave()">
                        <span class="validation-icon"></span>
                    </div>
                    
                    <div class="form-group" data-field="address">
                        <label>
                            Mailing Address (Recommended for Letters)
                            <span class="help-icon">
                                <span class="tooltip">Your mailing address appears on formal demand letters sent via certified mail. Helps the insurance company know where to send correspondence.</span>
                            </span>
                        </label>
                        <input type="text" id="address" placeholder="123 Main St, City, ST 12345" onblur="autoSave()">
                        <div class="help-text">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Include this for professional demand letters sent via postal mail
                        </div>
                    </div>
                    
                    <div class="form-group" data-field="vehicle">
                        <label>
                            Vehicle (Year Make Model) <span class="required">*</span>
                            <span class="help-icon">
                                <span class="tooltip">Enter your vehicle year, manufacturer, and model. Example: "2022 Toyota Camry" or "2019 Honda Accord"</span>
                            </span>
                        </label>
                        <input type="text" id="vehicle" placeholder="2022 Toyota Camry" oninput="validateField(this)" onblur="autoSave()">
                        <span class="validation-icon"></span>
                        <div class="help-text">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Example: 2022 Toyota Camry or 2019 Honda Accord
                        </div>
                    </div>
                    
                    <div class="form-group" data-field="vin">
                        <label>
                            VIN <span class="required">*</span>
                            <span class="help-icon">
                                <span class="tooltip">17-character Vehicle Identification Number. Found on your dashboard (driver's side), door frame, insurance card, or registration.</span>
                            </span>
                        </label>
                        <input type="text" id="vin" placeholder="1HGBH41JXMN109186" maxlength="17" oninput="formatVIN(this); validateField(this);" onblur="autoSave()">
                        <span class="validation-icon"></span>
                        <div class="help-text">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            17-character code on your dashboard (driver's side) or door frame
                        </div>
                    </div>
                    
                    <div class="form-group" data-field="mileage">
                        <label>
                            Mileage (Optional)
                            <span class="help-icon">
                                <span class="tooltip">Current odometer reading. Helpful for context but not required.</span>
                            </span>
                        </label>
                        <input type="text" id="mileage" inputmode="numeric" placeholder="45,000" oninput="formatMileage(this)" onblur="autoSave()">
                    </div>
                    
                    <div class="form-group" data-field="diminishedValue">
                        <label>
                            Diminished Value Amount <span class="required">*</span>
                            <span class="help-icon">
                                <span class="tooltip">The total diminished value from your Fair Market Impact Report (page 1). This is the amount you're claiming. If insurers challenge your valuation, Premium members get access to enhanced appraisal rebuttal tools.</span>
                            </span>
                        </label>
                        <input type="text" id="diminishedValue" inputmode="numeric" placeholder="$4,250" oninput="formatCurrency(this); validateField(this);" onblur="autoSave()">
                        <span class="validation-icon"></span>
                        <div class="help-text">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Find this on page 1 of your Fair Market Impact Report
                        </div>
                    </div>
                    
                    <div class="form-group" data-field="state">
                        <label>
                            State <span class="required">*</span>
                            <span class="help-icon">
                                <span class="tooltip">The state where the accident occurred. This determines which laws apply to your claim.</span>
                            </span>
                        </label>
                        <select id="state" oninput="validateField(this)" onchange="autoSave()">
                            <option value="">Select State...</option>
                        </select>
                        <span class="validation-icon"></span>
                    </div>
                    
                    <div class="form-group" data-field="insuranceCompany">
                        <label>
                            Insurance Company (Optional)
                            <span class="help-icon">
                                <span class="tooltip">Name of the at-fault party's insurance company (e.g., State Farm, GEICO, Allstate).</span>
                            </span>
                        </label>
                        <input type="text" id="insuranceCompany" placeholder="State Farm" onblur="autoSave()">
                    </div>
                    
                    <div class="form-group" data-field="policyNumber">
                        <label>
                            Policy Number (Optional)
                            <span class="help-icon">
                                <span class="tooltip">The insurance policy number for the at-fault party. Found on claim paperwork if available.</span>
                            </span>
                        </label>
                        <input type="text" id="policyNumber" placeholder="SF-1234567" onblur="autoSave()">
                    </div>
                    
                    <div class="form-group" data-field="claimNumber">
                        <label>
                            Claim Number (Optional)
                            <span class="help-icon">
                                <span class="tooltip">The claim number assigned by the insurance company. Found on claim correspondence.</span>
                            </span>
                        </label>
                        <input type="text" id="claimNumber" placeholder="CLM-2024-789" onblur="autoSave()">
                    </div>
                    
                    <div class="form-group" data-field="adjusterName">
                        <label>
                            Adjuster Name (Optional)
                            <span class="help-icon">
                                <span class="tooltip">Name of the insurance adjuster handling your claim, if assigned.</span>
                            </span>
                        </label>
                        <input type="text" id="adjusterName" placeholder="Jane Doe" onblur="autoSave()">
                    </div>
                    
                    <div class="form-group" data-field="adjusterEmail">
                        <label>
                            Adjuster Email (Optional)
                            <span class="help-icon">
                                <span class="tooltip">Email address of the insurance adjuster for digital correspondence.</span>
                            </span>
                        </label>
                        <input type="email" id="adjusterEmail" inputmode="email" placeholder="jane.doe@insurance.com" onblur="autoSave()">
                    </div>
                </div>
                
                <button class="btn btn-primary" id="saveInfoBtn" onclick="saveInfo()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Save My Information
                </button>
            </div>

            <!-- TAB CONTENT: GENERATE LETTER -->
            <div id="content-letter" class="tab-content">
                <h2 class="section-title" id="section-letter">📄 Generate Demand Letter</h2>
                <div class="tab-guidance">
                    <div class="tab-guidance-title">📬 Send Via Certified Mail</div>
                    <div class="tab-guidance-text">
                        <strong>Create your professional demand letter with one click.</strong> This letter includes your state's specific legal citations, case law, and deadlines — giving your claim maximum credibility. After generating, download as PDF for the most professional appearance, or copy/download as text. Send via certified mail with return receipt requested. Attach your Fair Market Impact Report and Fair Market Value Report. Keep copies of everything for your records. <span style="display: inline-block; margin-top: 8px; font-size: 14px; font-style: italic;">Note: If your initial claim is denied, <a href="https://www.myfairclaim.com/pricing" target="_blank" rel="noopener noreferrer" style="color: #1e40af; font-weight: 600; text-decoration: none;">Premium tier</a> provides rebuttal letter generators to respond effectively.</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="generateLetterBtn" onclick="generateLetter()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Generate My Demand Letter
                </button>
                
                <div id="letterOutput" class="output-box">
                    <h3>✅ Your Demand Letter</h3>
                    <div id="letterText" class="output-text"></div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" id="downloadLetterPDFBtn" onclick="downloadLetterPDF()">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                            </svg>
                            Download as PDF
                        </button>
                        <button class="btn btn-secondary" id="copyLetterBtn" onclick="copyText('letterText')">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy to Clipboard
                        </button>
                        <button class="btn btn-secondary" id="downloadLetterBtn" onclick="downloadText('letterText', 'Demand_Letter.txt')">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Download as TXT
                        </button>
                    </div>
                    
                    <div class="next-steps">
                        <div class="next-steps-title">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                            </svg>
                            <span>Next Steps - Do This Now:</span>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">1</div>
                            <div class="next-step-text">
                                <strong>PRINT</strong> your demand letter PDF (click the blue button above)
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">2</div>
                            <div class="next-step-text">
                                <strong>SIGN</strong> the letter in blue ink where it says "Sincerely, [Your Name]"
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">3</div>
                            <div class="next-step-text">
                                <strong>ATTACH</strong> these reports: • Fair Market Impact Report • Fair Market Value Report
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">4</div>
                            <div class="next-step-text">
                                <strong>MAIL</strong> via USPS Certified Mail with Return Receipt ($8 at post office) — this provides legal proof of delivery
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">5</div>
                            <div class="next-step-text">
                                <strong>WAIT</strong> for response (your state requires response within <span id="responseTime"></span> days) — Keep your certified mail receipt!
                            </div>
                        </div>
                    </div>
                    
                    <!-- CTA to Continue to Email -->
                    <div class="letter-cta-box" style="text-align: center; margin-top: 32px; padding: 28px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #3b82f6; border-radius: 12px;">
                        <div class="letter-cta-title" style="font-size: 18px; font-weight: 700; color: #1e40af; margin-bottom: 12px;">⚠️ Don't Stop Yet — You're 80% Complete!</div>
                        <div class="letter-cta-text" style="font-size: 15px; color: #1e3a8a; margin-bottom: 24px; font-weight: 500;">Generate your email template next to have <strong>both communication tools</strong> ready. Email is essential for follow-ups and digital correspondence with adjusters.</div>
                        <button onclick="switchTabAndScroll('email', 5, 'section-email')" class="letter-cta-button" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 16px 40px; border: none; border-radius: 10px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.3s; font-family: 'Outfit', sans-serif; animation: glow 2s ease-in-out infinite;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)';">
                            ✉️ Continue to Step 5: Generate Email Template
                        </button>
                        <div class="letter-cta-subtext" style="margin-top: 10px; font-size: 13px; color: #64748b; font-weight: 500;">Finish strong — get your complete toolkit in 1 more minute</div>
                    </div>
                </div>
            </div>

            <!-- TAB CONTENT: GENERATE EMAIL -->
            <div id="content-email" class="tab-content">
                <h2 class="section-title" id="section-email">✉️ Generate Email Template</h2>
                <div class="tab-guidance">
                    <div class="tab-guidance-title">💼 Professional Digital Communication</div>
                    <div class="tab-guidance-text">
                        <strong>Create email communications for adjusters and follow-ups.</strong> Use this for digital correspondence with insurance adjusters or for follow-ups after sending your demand letter. Click "Open Draft in Email Client" to automatically create a draft email with all details pre-filled, or copy/download the template to use manually. The email includes the same legal foundation as your demand letter but in a format optimized for email. Remember to attach your Fair Market Impact Report and Fair Market Value Report as PDFs before sending.
                    </div>
                </div>
                
                <button class="btn btn-primary" id="generateEmailBtn" onclick="generateEmail()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    Generate My Email Template
                </button>
                
                <div id="emailOutput" class="output-box">
                    <h3>✅ Your Email Template</h3>
                    
                    <div id="emailText" class="output-text"></div>
                    
                    <div class="button-group">
                        <button class="btn btn-primary" id="openEmailDraftBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            Open Draft in Email Client
                        </button>
                        <button class="btn btn-secondary" id="copyEmailBtn" onclick="copyText('emailText')">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy to Clipboard
                        </button>
                        <button class="btn btn-secondary" id="downloadEmailBtn" onclick="downloadText('emailText', 'Email_Template.txt')">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Download as TXT
                        </button>
                    </div>
                    
                    <div class="next-steps">
                        <div class="next-steps-title">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                            </svg>
                            <span>You're Fully Equipped - Here's How to Use Both Documents:</span>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">1</div>
                            <div class="next-step-text">
                                <strong>PRIMARY METHOD:</strong> Send your demand letter via USPS Certified Mail with Return Receipt as outlined in the "Generate Letter" tab
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">2</div>
                            <div class="next-step-text">
                                <strong>DIGITAL FOLLOW-UP:</strong> Use this email template to follow up with the adjuster 7-10 days after they receive your certified letter
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">3</div>
                            <div class="next-step-text">
                                <strong>OR IMMEDIATE CONTACT:</strong> If you already have an adjuster's email, you can send this email with your PDF reports attached right away
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">4</div>
                            <div class="next-step-text">
                                <strong>DOCUMENTATION:</strong> Keep copies of everything - certified mail receipt, email confirmations, all correspondence
                            </div>
                        </div>
                        
                        <div class="next-step-item">
                            <div class="next-step-number">5</div>
                            <div class="next-step-text">
                                <strong>IF THEY DON'T RESPOND:</strong> Use this same email template to escalate to the adjuster's supervisor and your state's Department of Insurance
                            </div>
                        </div>
                    </div>
                    
                    <!-- Continue to Complete Package -->
                    <div style="text-align: center; margin-top: 40px;">
                        <button onclick="switchTabAndScroll('complete', 6, 'section-complete')" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 16px 40px; border: none; border-radius: 10px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.3s; font-family: 'Outfit', sans-serif; animation: glow 2s ease-in-out infinite;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)';">
                            ✅ Continue to Step 6: Complete Package
                        </button>
                        <div style="margin-top: 10px; font-size: 13px; color: #64748b; font-weight: 500;">Review everything you've created and learn what's next</div>
                    </div>
                </div>
            </div>

            <!-- TAB CONTENT: COMPLETE PACKAGE -->
            <div id="content-complete" class="tab-content">
                <h2 class="section-title" id="section-complete">🎊 Your Complete Package</h2>
                <div class="tab-guidance">
                    <div class="tab-guidance-title">✅ Everything Ready to Deploy</div>
                    <div class="tab-guidance-text">
                        <strong>You've successfully completed the entire Fair Claim Submission Playbook™.</strong> You now have professional demand letter and email templates ready to use, backed by your state's specific legal framework. Review your accomplishments below and learn about advanced support options if you encounter resistance from insurers.
                    </div>
                </div>
                
                <!-- CELEBRATION MESSAGE -->
                <div class="celebration show" id="emailCelebration">
                        <div class="celebration-icon">🎊</div>
                        <div class="celebration-title">You've Completed Everything!</div>
                        <div class="celebration-text">
                            Outstanding work! You've finished all 6 steps of the Fair Claim Submission Playbook™ and have both a professional demand letter AND email template ready to deploy. You now have everything you need to successfully pursue your diminished value claim. Your preparation and thoroughness put you ahead of 90% of claimants. <span style="display: block; margin-top: 12px; font-size: 16px; font-style: italic;">Remember: <a href="https://www.myfairclaim.com/pricing" target="_blank" rel="noopener noreferrer" style="color: #1e40af; font-weight: 700; text-decoration: underline;">Premium tier</a> is available if insurers resist—our members see 23% higher recovery rates.</span>
                        </div>
                    </div>
                
                <!-- YOUR DOCUMENTS SECTION -->
                <div style="background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%); border: 3px solid #3b82f6; border-radius: 16px; padding: 32px; margin: 30px 0;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="font-size: 28px; font-weight: 800; color: #1e40af; margin-bottom: 8px;">📦 Your Complete Document Package</div>
                        <div style="font-size: 16px; color: #64748b; font-weight: 500;">Access both of your professional documents below</div>
                    </div>
                    
                    <div class="document-cards-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                        <!-- Demand Letter Card -->
                        <div class="document-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 20px; font-weight: 700; color: #1e40af; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 32px;">📄</span>
                                <span>Demand Letter</span>
                            </div>
                            <div style="font-size: 14px; color: #64748b; margin-bottom: 16px; line-height: 1.6;">
                                Professional demand letter with legal citations ready for certified mail delivery
                            </div>
                            <button onclick="switchTab('letter', 4); setTimeout(() => { const btn = document.getElementById('generateLetterBtn'); if(btn && btn.offsetParent !== null) btn.scrollIntoView({behavior: 'smooth', block: 'center'}); }, 100);" style="width: 100%; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 12px 20px; border: none; border-radius: 8px; font-size: 15px; font-weight: 700; cursor: pointer; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); transition: all 0.3s; font-family: 'Outfit', sans-serif;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(59, 130, 246, 0.3)';">
                                📄 View Demand Letter
                            </button>
                        </div>
                        
                        <!-- Email Template Card -->
                        <div class="document-card" style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 20px; font-weight: 700; color: #1e40af; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 32px;">✉️</span>
                                <span>Email Template</span>
                            </div>
                            <div style="font-size: 14px; color: #64748b; margin-bottom: 16px; line-height: 1.6;">
                                Professional email for digital communication with insurance adjusters
                            </div>
                            <button onclick="switchTab('email', 5); setTimeout(() => { const btn = document.getElementById('generateEmailBtn'); if(btn && btn.offsetParent !== null) btn.scrollIntoView({behavior: 'smooth', block: 'center'}); }, 100);" style="width: 100%; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 12px 20px; border: none; border-radius: 8px; font-size: 15px; font-weight: 700; cursor: pointer; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); transition: all 0.3s; font-family: 'Outfit', sans-serif;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(59, 130, 246, 0.3)';">
                                ✉️ View Email Template
                            </button>
                        </div>
                    </div>
                    
                    <style>
                        @media (max-width: 768px) {
                            .document-cards-grid {
                                grid-template-columns: 1fr !important;
                            }
                        }
                    
                        /* PROFESSIONAL TIER BADGE */
        .tier-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            color: #1e293b;
            padding: 10px 20px;
            font-size: 12px;
            font-weight: 800;
            letter-spacing: 2px;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid #94a3b8;
            z-index: 9999;
        }
        
        @media (max-width: 768px) {
            .tier-badge {
                font-size: 10px;
                padding: 6px 12px;
                top: 10px;
                left: 10px;
            }
        }

    
        /* BREATHING ANIMATION FOR INFO BOXES */
        @keyframes breathe {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
                transform: scale(1.01);
            }
        }
        
        .info-box:not(.open) {
            animation: breathe 2s ease-in-out infinite;
        }
        
        .info-box.open,
        .info-box.completed {
            animation: none;
        }

    </style>
                    
                    <div style="background: #eff6ff; border-left: 4px solid #3b82f6; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 14px; color: #1e40af; font-weight: 600; margin-bottom: 6px;">💡 Quick Tip</div>
                        <div style="font-size: 13px; color: #1e3a8a; line-height: 1.6;">
                            Click the buttons above to return to each section where you can download PDFs, copy text, or open email drafts. Both documents are saved and ready to use whenever you need them.
                        </div>
                    </div>
                </div>
                    
                    <!-- PREMIUM UPSELL - SUBDUED -->
                    <div class="premium-upsell-box" style="background: linear-gradient(135deg, #fefefe 0%, #f9fafb 100%); border: 2px solid #e5e7eb; border-radius: 10px; padding: 24px; margin: 30px 0; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 14px; flex-wrap: wrap;">
                            <div class="premium-badge" style="background: #f59e0b; color: white; padding: 6px 14px; border-radius: 16px; font-size: 12px; font-weight: 700; letter-spacing: 0.3px;">⭐ PREMIUM</div>
                            <div style="color: #6b7280; font-size: 13px; font-weight: 600;">23% Higher Recovery Rate</div>
                        </div>
                        <h3 class="premium-upsell-title" style="font-size: 18px; font-weight: 700; color: #374151; margin-bottom: 10px; line-height: 1.4;">Facing Resistance? Get the Advanced Tools That Win Denied Claims</h3>
                        <p class="premium-upsell-text" style="font-size: 14px; color: #6b7280; line-height: 1.5; margin-bottom: 18px; font-weight: 400;">When insurers push back, our Premium tier gives you the advanced ammunition you need to fight back and win.</p>
                        
                        <div class="premium-features" style="display: flex; gap: 10px; margin-bottom: 18px; flex-wrap: wrap;">
                            <div class="premium-feature-card" style="background: #f9fafb; padding: 12px; border-radius: 8px; border-left: 3px solid #10b981; flex: 1 1 200px; min-width: 180px;">
                                <div style="font-weight: 600; color: #047857; margin-bottom: 4px; font-size: 13px;">✓ Enhanced Negotiation Templates</div>
                                <div style="color: #6b7280; font-size: 12px; line-height: 1.4;">Precedent-based arguments that adjusters can't ignore</div>
                            </div>
                            <div class="premium-feature-card" style="background: #f9fafb; padding: 12px; border-radius: 8px; border-left: 3px solid #10b981; flex: 1 1 200px; min-width: 180px;">
                                <div style="font-weight: 600; color: #047857; margin-bottom: 4px; font-size: 13px;">✓ State-Specific Legal Packages</div>
                                <div style="color: #6b7280; font-size: 12px; line-height: 1.4;">Comprehensive research tailored to your jurisdiction</div>
                            </div>
                            <div class="premium-feature-card" style="background: #f9fafb; padding: 12px; border-radius: 8px; border-left: 3px solid #10b981; flex: 1 1 200px; min-width: 180px;">
                                <div style="font-weight: 600; color: #047857; margin-bottom: 4px; font-size: 13px;">✓ Rebuttal Letter Generators</div>
                                <div style="color: #6b7280; font-size: 12px; line-height: 1.4;">Counter every denial tactic with professional responses</div>
                            </div>
                            <div class="premium-feature-card" style="background: #f9fafb; padding: 12px; border-radius: 8px; border-left: 3px solid #10b981; flex: 1 1 200px; min-width: 180px;">
                                <div style="font-weight: 600; color: #047857; margin-bottom: 4px; font-size: 13px;">✓ Settlement Strategy Database</div>
                                <div style="color: #6b7280; font-size: 12px; line-height: 1.4;">Proven tactics from thousands of successful claims</div>
                            </div>
                        </div>

                        <div style="text-align: center;">
                            <a href="https://myfairclaim.com/order-form/?tier=premium" target="_blank" rel="noopener noreferrer" class="premium-upsell-button" style="display: inline-block; background: #f59e0b; color: white; padding: 12px 28px; border-radius: 8px; font-size: 15px; font-weight: 600; text-decoration: none; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(245, 158, 11, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(245, 158, 11, 0.2)';">
                                Learn About Premium
                            </a>
                            <div style="margin-top: 8px; font-size: 12px; color: #9ca3af; font-weight: 400;">Advanced tools for challenging claim situations</div>
                        </div>
                    </div>
            </div>
        </div>
        <!-- END CONTENT (All 6 tab sections) -->

        <!-- SIDEBAR -->
        
    </div>
    <!-- END MAIN-CONTAINER (Content + Sidebar grid) -->

    <!-- STICKY CTA (Mobile) - OUTSIDE main-container -->
    <div class="sticky-cta" id="stickyCTA">
        <div class="sticky-cta-inner">
            <div class="sticky-cta-text">Ready to generate your documents?</div>
            <button class="btn btn-primary" onclick="switchTabAndScroll('info', 3, 'section-info')" style="min-width: auto;">Complete Form →</button>
        </div>
    </div>

    <!-- AUTO-SAVE INDICATOR -->
    <div class="autosave-indicator" id="autosaveIndicator">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span>Your information is saved</span>
    </div>
    
    <!-- SWIPE HINT (Mobile Only) -->
    <div class="swipe-hint" id="swipeHint">
        👈 Swipe to navigate between tabs 👉
    </div>
    
    <!-- SESSION WARNING -->
    <div class="session-warning" id="sessionWarning">
        <div style="font-weight: 700; margin-bottom: 8px; font-size: 16px;">⏰ Still working?</div>
        <div style="font-size: 14px; margin-bottom: 12px;">You've been inactive for 25 minutes. Your work is saved, but click anywhere to stay active.</div>
        <button onclick="resetSessionTimer()" style="background: white; color: #d97706; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer;">I'm Still Here</button>
    </div>
    
    <!-- KEYBOARD SHORTCUTS OVERLAY -->
    <div class="shortcuts-overlay" id="shortcutsOverlay" onclick="if(event.target === this) toggleShortcuts()">
        <div class="shortcuts-panel">
            <h2 style="margin-top: 0; margin-bottom: 24px; font-family: 'Outfit', sans-serif;">⌨️ Keyboard Shortcuts</h2>
            
            <div class="shortcut-row">
                <span>Save Information</span>
                <span class="shortcut-key">Ctrl/Cmd + S</span>
            </div>
            <div class="shortcut-row">
                <span>Generate Letter/Email</span>
                <span class="shortcut-key">Ctrl/Cmd + G</span>
            </div>
            <div class="shortcut-row">
                <span>Print Current Tab</span>
                <span class="shortcut-key">Ctrl/Cmd + P</span>
            </div>
            <div class="shortcut-row">
                <span>Next Tab</span>
                <span class="shortcut-key">Ctrl/Cmd + →</span>
            </div>
            <div class="shortcut-row">
                <span>Previous Tab</span>
                <span class="shortcut-key">Ctrl/Cmd + ←</span>
            </div>
            <div class="shortcut-row">
                <span>Jump to Tab 1-5</span>
                <span class="shortcut-key">1, 2, 3, 4, 5</span>
            </div>
            <div class="shortcut-row">
                <span>Toggle Dark Mode</span>
                <span class="shortcut-key">Ctrl/Cmd + D</span>
            </div>
            <div class="shortcut-row">
                <span>Show This Help</span>
                <span class="shortcut-key">?</span>
            </div>
            
            <button onclick="toggleShortcuts()" style="margin-top: 24px; width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">Close</button>
        </div>
    </div>
    
    <!-- SWIPE INDICATORS -->
    <div class="swipe-indicator left" id="swipeLeft">← Previous</div>
    <div class="swipe-indicator right" id="swipeRight">Next →</div>

    <!-- FOOTER -->
    <div class="footer">
        <div class="footer-content">
            <div style="flex: 1;">
                <p class="footer-text">© 2026 MyFairClaim LLC. All rights reserved.</p>
                <p class="footer-text">Professional Diminished Value Claims Service | Scottsdale, Arizona</p>
                <p class="footer-disclaimer">
                    <strong>LEGAL DISCLAIMER:</strong> This tool provides educational information only and does not constitute legal advice or the performance of insurance adjusting services. The information provided is for informational purposes to help you understand your rights and the claims process. For legal advice specific to your situation, consult a licensed attorney in your jurisdiction. For professional claims assistance, consult a licensed insurance adjuster.
                </p>
            </div>
            <div>
                <a href="https://www.bbb.org/us/az/scottsdale/profile/insurance-claims-processing/myfairclaim-llc-1126-1000150972/#sealclick" target="_blank" rel="nofollow">
                    <img src="https://seal-central-northern-western-arizona.bbb.org/seals/blue-seal-200-65-bbb-1000150972.png" style="border: 0; height: 65px; width: auto;" alt="MyFairClaim LLC BBB Business Review" />
                </a>
            </div>
        </div>
    </div>

    <script>
    // ===== MOBILE OPTIMIZATION FEATURES =====
    
    // Toast Notification System
    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        // Check if message already starts with an icon
        const hasIcon = message.trim().match(/^[✓✅⚠❌ℹ️]/);
        const icon = hasIcon ? '' : (type === 'success' ? '✓' : type === 'error' ? '⚠' : 'ℹ');
        
        toast.innerHTML = icon ? `<span style="font-size: 18px;">${icon}</span><span>${message}</span>` : `<span>${message}</span>`;
        
        document.body.appendChild(toast);
        
        // Haptic feedback (mobile only)
        if (navigator.vibrate) {
            const pattern = type === 'success' ? [10, 50, 10] : type === 'error' ? [50] : [20];
            navigator.vibrate(pattern);
        }
        
        // Auto-remove after 3 seconds
        setTimeout(() => {
            toast.style.animation = 'fadeOutToast 0.3s ease-out';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    
    // Auto-scroll to first validation error
    function scrollToFirstError() {
        const firstError = document.querySelector('.form-group.error');
        if (firstError) {
            firstError.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // Focus the input for immediate correction
            const input = firstError.querySelector('input, select');
            if (input) {
                setTimeout(() => input.focus(), 500);
            }
            
            showToast('Please fix the highlighted fields', 'error');
            return true;
        }
        return false;
    }
    
    // Loading state management
    function setLoadingState(button, loading, originalText = null) {
        if (loading) {
            button.disabled = true;
            button.setAttribute('data-original-text', button.innerHTML);
            button.innerHTML = `<span class="spinner"></span><span style="margin-left: 8px;">Loading...</span>`;
        } else {
            button.disabled = false;
            button.innerHTML = originalText || button.getAttribute('data-original-text') || 'Continue';
        }
    }
    
    // Haptic feedback helper
    function haptic(type = 'light') {
        if (!navigator.vibrate) return;
        
        const patterns = {
            light: 10,
            medium: 20,
            heavy: [30, 10, 30],
            success: [10, 50, 10],
            error: [50, 20, 50]
        };
        
        navigator.vibrate(patterns[type] || 10);
    }
    
    // Enhanced copy to clipboard with feedback
    async function copyToClipboardEnhanced(text, successMessage = 'Copied to clipboard!') {
        try {
            await navigator.clipboard.writeText(text);
            showToast(successMessage, 'success');
            haptic('success');
            return true;
        } catch (err) {
            console.error('Copy failed:', err);
            showToast('Copy failed. Please try again.', 'error');
            return false;
        }
    }
    
    // Detect if device is mobile
    function isMobile() {
        return window.innerWidth <= 768 || 'ontouchstart' in window;
    }
    
    // Prevent accidental navigation with unsaved changes
    let hasUnsavedChanges = false;
    let isFormComplete = false;
    
    window.addEventListener('beforeunload', (e) => {
        if (hasUnsavedChanges && !isFormComplete) {
            e.preventDefault();
            e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
            return e.returnValue;
        }
    });
    
    // Track form changes
    function markFormAsChanged() {
        hasUnsavedChanges = true;
    }
    
    function markFormAsComplete() {
        isFormComplete = true;
        hasUnsavedChanges = false;
    }
    
    // Native Share API with fallback
    
    // Swipe gesture detection (mobile only)
    let touchStartX = 0;
    let touchEndX = 0;
    let touchStartY = 0;
    let touchEndY = 0;
    
    function handleSwipeGesture() {
        const diffX = touchEndX - touchStartX;
        const diffY = touchEndY - touchStartY;
        
        // Only register horizontal swipes
        if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
            const swipeLeft = document.getElementById('swipeLeft');
            const swipeRight = document.getElementById('swipeRight');
            
            if (diffX > 0) {
                // Swipe right - previous tab
                if (currentTabIndex > 0) {
                    swipeLeft.classList.add('show');
                    setTimeout(() => swipeLeft.classList.remove('show'), 500);
                    switchToPreviousTab();
                    haptic('light');
                }
            } else {
                // Swipe left - next tab
                if (currentTabIndex < tabOrder.length - 1) {
                    swipeRight.classList.add('show');
                    setTimeout(() => swipeRight.classList.remove('show'), 500);
                    switchToNextTab();
                    haptic('light');
                }
            }
        }
    }
    
    if (isMobile()) {
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });
        
        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipeGesture();
        }, { passive: true });
    }
    
    // Screen Wake Lock (keeps screen on while reading state laws)
    let wakeLock = null;
    
    async function requestWakeLock() {
        if ('wakeLock' in navigator && isMobile()) {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log('Screen wake lock activated');
                
                // Re-acquire wake lock if page becomes visible again
                wakeLock.addEventListener('release', () => {
                    console.log('Wake lock released');
                });
            } catch (err) {
                console.log('Wake lock not available:', err);
            }
        }
    }
    
    async function releaseWakeLock() {
        if (wakeLock !== null) {
            try {
                await wakeLock.release();
                wakeLock = null;
                console.log('Wake lock manually released');
            } catch (err) {
                console.log('Error releasing wake lock:', err);
            }
        }
    }
    
    // Tab navigation helpers
    const tabOrder = ['guide', 'laws', 'info', 'letter', 'email', 'complete'];
    let currentTabIndex = 0;
    
    function switchToNextTab() {
        if (currentTabIndex < tabOrder.length - 1) {
            currentTabIndex++;
            const nextTab = tabOrder[currentTabIndex];
            switchTab(nextTab, currentTabIndex + 1);
        }
    }
    
    function switchToPreviousTab() {
        if (currentTabIndex > 0) {
            currentTabIndex--;
            const prevTab = tabOrder[currentTabIndex];
            switchTab(prevTab, currentTabIndex + 1);
        }
    }
    
    // Offline/Online detection
    window.addEventListener('online', () => {
        showToast('✓ Back online - your work is safe', 'success');
        haptic('success');
    });
    
    window.addEventListener('offline', () => {
        showToast('⚠ You\'re offline - all work saved locally', 'info');
        haptic('medium');
    });
    
    // Progress persistence - remember which tab user was on
    function saveProgress() {
        localStorage.setItem('cfgCurrentTab', currentTabIndex);
        localStorage.setItem('cfgLastVisit', Date.now());
    }
    
    function restoreProgress() {
        const savedTab = localStorage.getItem('cfgCurrentTab');
        const lastVisit = localStorage.getItem('cfgLastVisit');
        
        // Only restore if visited within last 24 hours
        if (savedTab && lastVisit && Date.now() - parseInt(lastVisit) < 24 * 60 * 60 * 1000) {
            const tabIndex = parseInt(savedTab);
            if (tabIndex > 0 && tabIndex < tabOrder.length) {
                setTimeout(() => {
                    switchTab(tabOrder[tabIndex], tabIndex + 1);
                    showToast('Resuming where you left off...', 'info');
                }, 500);
            }
        }
    }
    
    // Copy all documents function
    function copyAllDocuments() {
        const letter = document.getElementById('letterText')?.textContent;
        const email = document.getElementById('emailText')?.textContent;
        
        if (!letter && !email) {
            showToast('⚠ Generate your documents first', 'error');
            return;
        }
        
        let combined = '';
        if (letter) {
            combined += '═══════════════════════════════════════\n';
            combined += '        DEMAND LETTER\n';
            combined += '═══════════════════════════════════════\n\n';
            combined += letter;
        }
        
        if (email) {
            if (combined) combined += '\n\n\n\n';
            combined += '═══════════════════════════════════════\n';
            combined += '        EMAIL TEMPLATE\n';
            combined += '═══════════════════════════════════════\n\n';
            combined += email;
        }
        
        copyToClipboardEnhanced(combined, '✓ All documents copied to clipboard!');
    }
    
    // Pull to refresh (mobile only)
    let pullStartY = 0;
    let isPulling = false;
    
    if (isMobile()) {
        document.addEventListener('touchstart', (e) => {
            if (window.scrollY === 0) {
                pullStartY = e.touches[0].clientY;
                isPulling = true;
            }
        }, { passive: true });
        
        document.addEventListener('touchmove', (e) => {
            if (!isPulling) return;
            
            const currentY = e.touches[0].clientY;
            const pullDistance = currentY - pullStartY;
            
            if (pullDistance > 100 && window.scrollY === 0) {
                showToast('↻ Refreshing...', 'info');
                setTimeout(() => location.reload(), 300);
                isPulling = false;
            }
        }, { passive: true });
        
        document.addEventListener('touchend', () => {
            isPulling = false;
        }, { passive: true });
    }
    
    // Voice input support (Web Speech API)
    let recognition = null;
    let currentVoiceInput = null;
    
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';
        
        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            if (currentVoiceInput) {
                currentVoiceInput.value = transcript;
                currentVoiceInput.dispatchEvent(new Event('input', { bubbles: true }));
                showToast('✓ Voice input captured', 'success');
                haptic('success');
            }
        };
        
        recognition.onerror = (event) => {
            showToast('⚠ Voice input failed - try again', 'error');
            if (currentVoiceInput) {
                const voiceBtn = currentVoiceInput.nextElementSibling;
                if (voiceBtn && voiceBtn.classList.contains('voice-btn')) {
                    voiceBtn.classList.remove('listening');
                }
            }
        };
        
        recognition.onend = () => {
            if (currentVoiceInput) {
                const voiceBtn = currentVoiceInput.nextElementSibling;
                if (voiceBtn && voiceBtn.classList.contains('voice-btn')) {
                    voiceBtn.classList.remove('listening');
                }
            }
        };
    }
    
    function startVoiceInput(inputId) {
        if (!recognition) {
            showToast('⚠ Voice input not supported', 'error');
            return;
        }
        
        currentVoiceInput = document.getElementById(inputId);
        const voiceBtn = currentVoiceInput.nextElementSibling;
        
        if (voiceBtn && voiceBtn.classList.contains('voice-btn')) {
            voiceBtn.classList.add('listening');
        }
        
        try {
            recognition.start();
            showToast('🎤 Listening...', 'info');
            haptic('medium');
        } catch (error) {
            recognition.stop();
            setTimeout(() => recognition.start(), 100);
        }
    }
    
    // Field autocomplete from previous entries
    const autocompleteFields = ['insuranceCompany', 'vehicle'];
    
    function initAutocomplete() {
        autocompleteFields.forEach(fieldId => {
            const input = document.getElementById(fieldId);
            if (!input) return;
            
            const storageKey = `cfgRecent_${fieldId}`;
            const recentValues = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            if (recentValues.length > 0) {
                const datalist = document.createElement('datalist');
                datalist.id = `${fieldId}-list`;
                
                recentValues.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    datalist.appendChild(option);
                });
                
                document.body.appendChild(datalist);
                input.setAttribute('list', datalist.id);
            }
            
            // Save new values
            input.addEventListener('change', () => {
                if (!input.value) return;
                
                let recent = JSON.parse(localStorage.getItem(storageKey) || '[]');
                if (!recent.includes(input.value)) {
                    recent.unshift(input.value);
                    recent = recent.slice(0, 5); // Keep only 5 recent
                    localStorage.setItem(storageKey, JSON.stringify(recent));
                }
            });
        });
    }
    
    // Dark mode toggle
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        localStorage.setItem('cfgDarkMode', isDark);
        showToast(isDark ? '🌙 Dark mode enabled' : '☀️ Light mode enabled', 'info');
    }
    
    // Initialize dark mode from preference
    function initDarkMode() {
        const savedPreference = localStorage.getItem('cfgDarkMode');
        const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedPreference === 'true' || (savedPreference === null && systemPreference)) {
            document.body.classList.add('dark-mode');
        }
    }
    
    // Session timeout warning (30 minutes)
    let sessionTimer = null;
    let sessionWarningTimer = null;
    const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes
    const WARNING_TIME = 25 * 60 * 1000; // 25 minutes
    
    function resetSessionTimer() {
        clearTimeout(sessionTimer);
        clearTimeout(sessionWarningTimer);
        
        // Hide warning if shown
        const warning = document.getElementById('sessionWarning');
        if (warning) warning.classList.remove('show');
        
        // Show warning after 25 minutes
        sessionWarningTimer = setTimeout(() => {
            if (warning) {
                warning.classList.add('show');
                haptic('medium');
            }
        }, WARNING_TIME);
        
        // Auto-save and notify after 30 minutes
        sessionTimer = setTimeout(() => {
            autoSave();
            saveProgress();
            showToast('⏰ Session saved due to inactivity', 'info');
        }, SESSION_TIMEOUT);
    }
    
    // Track user activity
    ['mousedown', 'keypress', 'scroll', 'touchstart'].forEach(event => {
        document.addEventListener(event, resetSessionTimer, { passive: true });
    });
    
    // Keyboard shortcuts overlay
    function toggleShortcuts() {
        const overlay = document.getElementById('shortcutsOverlay');
        if (overlay) {
            overlay.classList.toggle('show');
        }
    }
    
    // Enhanced keyboard shortcuts with dark mode and help
    document.addEventListener('keydown', (e) => {
        // Show shortcuts on "?"
        if (e.key === '?' && !e.target.matches('input, textarea')) {
            e.preventDefault();
            toggleShortcuts();
            return;
        }
        
        // Only on desktop, don't interfere with form inputs
        if (window.innerWidth <= 768 || e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }
        
        if (e.ctrlKey || e.metaKey) {
            switch(e.key.toLowerCase()) {
                case 's':
                    e.preventDefault();
                    saveInfo();
                    break;
                case 'g':
                    e.preventDefault();
                    if (currentTabIndex === 3) generateLetter();
                    else if (currentTabIndex === 4) generateEmail();
                    break;
                case 'p':
                    e.preventDefault();
                    window.print();
                    break;
                case 'd':
                    e.preventDefault();
                    toggleDarkMode();
                    break;
                case 'arrowleft':
                    e.preventDefault();
                    switchToPreviousTab();
                    break;
                case 'arrowright':
                    e.preventDefault();
                    switchToNextTab();
                    break;
            }
        }
        
        // Tab switching with number keys (1-5)
        if (e.key >= '1' && e.key <= '5' && !e.ctrlKey && !e.metaKey && !e.shiftKey && !e.target.matches('input, textarea')) {
            const tabIndex = parseInt(e.key) - 1;
            switchTab(tabOrder[tabIndex], tabIndex + 1);
        }
    });
    
    // Performance monitoring
    function logPerformance() {
        if ('performance' in window) {
            const perfData = performance.getEntriesByType('navigation')[0];
            if (perfData) {
                console.log('📊 Performance Metrics:');
                console.log(`  Load Time: ${Math.round(perfData.loadEventEnd - perfData.fetchStart)}ms`);
                console.log(`  DOM Ready: ${Math.round(perfData.domContentLoadedEventEnd - perfData.fetchStart)}ms`);
                console.log(`  Interactive: ${Math.round(perfData.domInteractive - perfData.fetchStart)}ms`);
            }
        }
    }
    
    // Error boundary - catch and report JavaScript errors
    window.addEventListener('error', (e) => {
        console.error('❌ JavaScript Error:', e.message, 'at', e.filename, e.lineno);
        showToast('⚠ An error occurred - your work is safe', 'error');
        
        // Auto-save on error to prevent data loss
        autoSave();
    });
    
    // Unhandled promise rejections
    window.addEventListener('unhandledrejection', (e) => {
        console.error('❌ Unhandled Promise Rejection:', e.reason);
        showToast('⚠ An error occurred - your work is safe', 'error');
    });
    
    // ===== STATES DATABASE =====
    const STATES = {
        "AL": {name: "Alabama", strength: "🟢 Strong", law: "Alabama recognizes diminished value as compensable property damage under common law tort principles.", caselaw: "Green Tree Acceptance Inc. v. Lazenby, 736 So. 2d 1259 (Ala. 1999) - Diminished value is recoverable element of property damage", statute: "Ala. Code § 27-23-2 - Property damage includes all economic losses", time: "15 business days for written acknowledgment, 30 days for substantive response", tips: "Alabama law favors claimants. Cite Green Tree case prominently. Request timely response per statute."},
        "AK": {name: "Alaska", strength: "🟢 Strong", law: "Alaska law permits recovery of diminished value as part of property damage under negligence principles.", caselaw: "McGee v. State Farm Mut. Auto. Ins. Co., 315 P.3d 830 (Alaska 2013) - Diminished value is compensable", statute: "Alaska Stat. § 21.36.125 - Requires prompt claim handling", time: "30 days to acknowledge claim, 45 days to accept or deny", tips: "Strong consumer protection state. Emphasize prompt payment requirements and fair dealing obligations."},
        "AZ": {name: "Arizona", strength: "🟢 Strong", law: "Arizona courts recognize diminished value as a compensable element of property damage in tort claims.", caselaw: "Giertz v. Bakker, 651 P.2d 1282 (Ariz. Ct. App. 1982) - Loss of market value is recoverable", statute: "A.R.S. § 20-461 - Unfair claim settlement practices", time: "15 days to acknowledge, 40 days to accept or deny with reasons", tips: "Arizona strongly protects claimants. Reference unfair practices statute. Demand timely written response."},
        "AR": {name: "Arkansas", strength: "🟡 Moderate", law: "Arkansas permits diminished value recovery though case law is less developed than neighboring states.", caselaw: "Farm Bureau Mut. Ins. Co. v. Foote, 14 S.W.3d 512 (Ark. 2000) - Property damage includes market value loss", statute: "Ark. Code Ann. § 23-79-208 - Claim handling requirements", time: "30 days to acknowledge, 60 days to accept or deny", tips: "Present strong documentation. Reference Texas and Georgia precedents for support."},
        "CA": {name: "California", strength: "🟢 Strong", law: "California strongly recognizes diminished value under both first-party and third-party claims.", caselaw: "Hough v. Allstate Ins. Co., 28 Cal. App. 4th 1553 (1994) - Diminished value explicitly compensable", statute: "Cal. Ins. Code § 2695.7 - Prompt investigation and response required", time: "15 days to acknowledge, 40 days to accept or deny", tips: "California has strongest consumer protections. Cite Insurance Code for prompt handling requirements."},
        "CO": {name: "Colorado", strength: "🟢 Strong", law: "Colorado law permits recovery of diminished value as economic loss in property damage claims.", caselaw: "Leyva v. Buley, 67 P.3d 1238 (Colo. 2003) - Market value diminution is recoverable", statute: "C.R.S. § 10-3-1104 - Unfair claims practices", time: "30 days to acknowledge, 45 days to pay or deny", tips: "Strong consumer state. Reference unfair practices statute and demand compliance."},
        "CT": {name: "Connecticut", strength: "🟢 Strong", law: "Connecticut recognizes diminished value as compensable property damage under tort law.", caselaw: "Bouchard v. People's Bank, 219 Conn. 465 (1991) - Economic loss includes diminished value", statute: "Conn. Gen. Stat. § 38a-816 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Cite unfair practices statute. Connecticut courts favor documented economic losses."},
        "DE": {name: "Delaware", strength: "🟡 Moderate", law: "Delaware permits diminished value claims though statutory guidance is limited.", caselaw: "Morris v. Chrysler Corp., 967 A.2d 1026 (Del. 2009) - Property damage includes market value loss", statute: "18 Del. C. § 2304 - Insurance claim handling", time: "30 days to respond to claim", tips: "Professional documentation critical. Reference neighboring state precedents."},
        "DC": {name: "District of Columbia", strength: "🟢 Strong", law: "D.C. recognizes diminished value as compensable property damage with strong consumer protections.", caselaw: "Travelers Indem. Co. v. Armstrong, 442 A.2d 289 (D.C. 1982) - Diminished value recoverable", statute: "D.C. Code § 31-2231.20 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong consumer protection jurisdiction. Cite unfair practices statute and demand compliance."},
        "FL": {name: "Florida", strength: "🟢 Strong", law: "Florida courts consistently recognize diminished value as compensable property damage.", caselaw: "Indem. Ins. Co. v. American Aviation, Inc., 891 So. 2d 532 (Fla. 2004) - Diminished value explicitly recoverable", statute: "Fla. Stat. § 626.9541 - Unfair claim settlement practices", time: "14 days to acknowledge, 90 days to resolve", tips: "Cite Insurance Code unfair practices. Florida strongly protects claimants."},
        "GA": {name: "Georgia", strength: "🟢 Very Strong", law: "Georgia has most favorable diminished value law in the nation with explicit statutory recognition.", caselaw: "Mabry v. State Farm Mut. Auto. Ins. Co., 274 Ga. 498 (2001) - Landmark DV case establishing clear recovery rights", statute: "O.C.G.A. § 33-34-5 - Property damage includes diminished value; Georgia has 17c DV formula", time: "15 days to acknowledge, 40 days to accept or deny", tips: "Georgia is THE strongest DV state. Cite Mabry case and 17c formula. Demand prompt compliance."},
        "HI": {name: "Hawaii", strength: "🟡 Moderate", law: "Hawaii permits diminished value recovery as economic loss in tort claims.", caselaw: "Kang v. Harrington, 59 Haw. 652 (1978) - Property damage includes market value diminution", statute: "Haw. Rev. Stat. § 431:13-103 - Unfair claims practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Present strong documentation. Reference California precedents for support."},
        "ID": {name: "Idaho", strength: "🟡 Moderate", law: "Idaho recognizes diminished value though case law is developing.", caselaw: "Jenkins v. Boise Cascade Corp., 141 Idaho 233 (2005) - Economic loss includes market value diminution", statute: "Idaho Code § 41-1329 - Unfair claim settlement practices", time: "30 days to acknowledge claim", tips: "Professional documentation important. Reference neighboring state precedents."},
        "IL": {name: "Illinois", strength: "🟢 Strong", law: "Illinois strongly recognizes diminished value as compensable property damage.", caselaw: "Sarlo v. Sears, Roebuck & Co., 358 Ill. App. 3d 706 (2005) - Diminished value is recoverable", statute: "215 ILCS 5/154.6 - Unfair claims practices", time: "15 days to acknowledge, 45 days to resolve", tips: "Strong consumer state. Cite unfair practices statute and demand timely response."},
        "IN": {name: "Indiana", strength: "🟢 Strong", law: "Indiana recognizes diminished value as compensable element of property damage.", caselaw: "Erie Ins. Co. v. George, 681 N.E.2d 183 (Ind. 1997) - Market value loss is recoverable", statute: "Ind. Code § 27-4-1-4.5 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Reference Erie Insurance case. Indiana courts favor documented losses."},
        "IA": {name: "Iowa", strength: "🟡 Moderate", law: "Iowa permits diminished value claims as economic loss in property damage.", caselaw: "Benning v. State Farm Mut. Auto. Ins. Co., 723 N.W.2d 663 (Iowa 2006) - DV recoverable in third-party claims", statute: "Iowa Code § 507B.4 - Unfair claim settlement practices", time: "30 days to acknowledge claim", tips: "Strong documentation essential. Reference unfair practices statute."},
        "KS": {name: "Kansas", strength: "🟢 Strong", law: "Kansas recognizes diminished value as compensable property damage under tort law.", caselaw: "Renfro v. Quik Trip Corp., 34 Kan. App. 2d 1010 (2006) - Diminished value recoverable", statute: "K.S.A. § 40-2404 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Kansas courts favor claimants with documentation. Cite unfair practices statute."},
        "KY": {name: "Kentucky", strength: "🟡 Moderate", law: "Kentucky permits diminished value recovery though case law is developing.", caselaw: "Davidson v. American Freightways, Inc., 25 S.W.3d 94 (Ky. 2000) - Economic loss includes market value diminution", statute: "KRS § 304.12-230 - Unfair claim settlement practices", time: "30 days to respond to claim", tips: "Professional documentation critical. Reference Tennessee precedents for support."},
        "LA": {name: "Louisiana", strength: "🟡 Moderate", law: "Louisiana recognizes diminished value under its unique civil law system.", caselaw: "Matherne v. Barrera, 658 So. 2d 615 (La. Ct. App. 1995) - Property damage includes market value loss", statute: "La. R.S. 22:1973 - Unfair claims practices", time: "30 days to acknowledge, 60 days to resolve", tips: "Louisiana has unique civil law. Strong documentation essential for recovery."},
        "ME": {name: "Maine", strength: "🟡 Moderate", law: "Maine permits diminished value claims as economic loss in property damage.", caselaw: "Lane v. Gendron, 645 A.2d 354 (Me. 1994) - Economic loss recoverable", statute: "24-A M.R.S. § 2436-A - Unfair claim settlement practices", time: "30 days to acknowledge claim", tips: "Professional documentation important. Reference New England precedents."},
        "MD": {name: "Maryland", strength: "🟡 Moderate", law: "Maryland recognizes diminished value though recovery standards are developing.", caselaw: "Romero v. Brenes, 368 Md. 485 (2002) - Market value loss is compensable", statute: "Md. Code Ann., Ins. § 27-303 - Unfair claims practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong documentation essential. Reference Virginia and D.C. precedents."},
        "MA": {name: "Massachusetts", strength: "🟢 Strong", law: "Massachusetts recognizes diminished value with strong consumer protections.", caselaw: "Sanford v. Boston Edison Co., 316 Mass. 631 (1944) - Property damage includes market value loss", statute: "Mass. Gen. Laws ch. 93A - Consumer protection; ch. 176D - Unfair claims practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Chapter 93A provides strong consumer protections. Cite unfair practices statute."},
        "MI": {name: "Michigan", strength: "🟡 Moderate", law: "Michigan permits diminished value claims though no-fault system creates complexities.", caselaw: "Liddel v. Detroit, 497 N.W.2d 695 (Mich. Ct. App. 1993) - DV recoverable in third-party claims", statute: "MCL § 500.2006 - Unfair claim settlement practices", time: "30 days to acknowledge claim", tips: "Michigan no-fault complicates DV claims. Third-party claims have better success rate."},
        "MN": {name: "Minnesota", strength: "🟡 Moderate", law: "Minnesota recognizes diminished value as economic loss in property damage claims.", caselaw: "Klosowski v. Kasterko, 416 N.W.2d 889 (Minn. 1987) - Market value diminution compensable", statute: "Minn. Stat. § 72A.20 - Unfair claim settlement practices", time: "30 days to acknowledge, 60 days to resolve", tips: "Professional documentation critical. Reference unfair practices statute."},
        "MS": {name: "Mississippi", strength: "🟡 Moderate", law: "Mississippi permits diminished value recovery under tort law.", caselaw: "State Farm Mut. Auto. Ins. Co. v. Nix, 735 So. 2d 898 (Miss. 1999) - DV recoverable", statute: "Miss. Code Ann. § 83-5-29 - Unfair claim settlement practices", time: "30 days to respond to claim", tips: "Strong documentation essential. Reference Alabama and Georgia precedents."},
        "MO": {name: "Missouri", strength: "🟢 Strong", law: "Missouri courts consistently recognize diminished value as compensable property damage.", caselaw: "Rodriguez v. General Accident Ins. Co., 808 S.W.2d 379 (Mo. 1991) - Diminished value explicitly recoverable", statute: "Mo. Rev. Stat. § 375.1007 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong consumer state. Cite Rodriguez case and unfair practices statute."},
        "MT": {name: "Montana", strength: "🟡 Moderate", law: "Montana permits diminished value claims as economic loss.", caselaw: "Farmers Ins. Exch. v. Schropp, 327 Mont. 231 (2005) - Property damage includes market value loss", statute: "Mont. Code Ann. § 33-18-201 - Unfair claims practices", time: "30 days to acknowledge claim", tips: "Professional documentation important. Reference Idaho precedents."},
        "NE": {name: "Nebraska", strength: "🟡 Moderate", law: "Nebraska recognizes diminished value though case law is developing.", caselaw: "Rahmig v. Mosley Machinery Co., 226 Neb. 423 (1987) - Economic loss includes market value diminution", statute: "Neb. Rev. Stat. § 44-1536 - Unfair claim settlement practices", time: "30 days to respond to claim", tips: "Strong documentation essential. Reference Kansas precedents for support."},
        "NV": {name: "Nevada", strength: "🟡 Moderate", law: "Nevada permits diminished value recovery as property damage.", caselaw: "Certified Fire Prot. Inc. v. Precision Constr., 128 Nev. 371 (2012) - Economic loss recoverable", statute: "Nev. Rev. Stat. § 686A.310 - Unfair claims practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Professional documentation critical. Reference California precedents."},
        "NH": {name: "New Hampshire", strength: "🟡 Moderate", law: "New Hampshire recognizes diminished value as compensable property damage.", caselaw: "Petition of McLaughlin, 112 N.H. 428 (1972) - Market value loss recoverable", statute: "N.H. Rev. Stat. Ann. § 417:4 - Unfair claims practices", time: "30 days to acknowledge claim", tips: "Strong documentation essential. Reference Massachusetts precedents."},
        "NJ": {name: "New Jersey", strength: "🟢 Strong", law: "New Jersey strongly recognizes diminished value with favorable case law.", caselaw: "Rios v. Mun. Util. Auth., 393 N.J. Super. 175 (2007) - Diminished value clearly compensable", statute: "N.J.S.A. 17:29B-4 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong consumer state. Cite Rios case and unfair practices statute."},
        "NM": {name: "New Mexico", strength: "🟡 Moderate", law: "New Mexico permits diminished value claims as economic loss.", caselaw: "Torres v. El Paso Elec. Co., 127 N.M. 729 (1999) - Property damage includes market value loss", statute: "N.M. Stat. Ann. § 59A-16-20 - Unfair claims practices", time: "30 days to respond to claim", tips: "Professional documentation important. Reference Texas and Colorado precedents."},
        "NY": {name: "New York", strength: "🟢 Strong", law: "New York recognizes diminished value with strong consumer protection framework.", caselaw: "Sabetay v. Sterling Drug, Inc., 69 N.Y.2d 329 (1987) - Economic loss includes market value diminution", statute: "N.Y. Ins. Law § 2601 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong consumer protections. Cite unfair practices statute and demand compliance."},
        "NC": {name: "North Carolina", strength: "🟢 Strong", law: "North Carolina strongly recognizes diminished value as compensable property damage.", caselaw: "Lawrence v. Builders Supplies Co., 149 N.C. App. 766 (2002) - Diminished value recoverable", statute: "N.C. Gen. Stat. § 58-63-15 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong case law. Reference Lawrence case and unfair practices statute."},
        "ND": {name: "North Dakota", strength: "🟡 Moderate", law: "North Dakota permits diminished value recovery though case law is limited.", caselaw: "Baker v. National Union Fire Ins. Co., 341 N.W.2d 673 (N.D. 1983) - Property damage includes market value loss", statute: "N.D. Cent. Code § 26.1-04-03 - Unfair claims practices", time: "30 days to respond to claim", tips: "Strong documentation essential. Reference Minnesota precedents."},
        "OH": {name: "Ohio", strength: "🟢 Strong", law: "Ohio courts consistently recognize diminished value as compensable property damage.", caselaw: "Posin v. A.B.C. Motor Court Hotel, 45 Ohio St. 2d 271 (1976) - Market value loss recoverable", statute: "Ohio Rev. Code § 3901.21 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong consumer state. Cite Posin case and unfair practices statute."},
        "OK": {name: "Oklahoma", strength: "🟡 Moderate", law: "Oklahoma recognizes diminished value as economic loss in property damage claims.", caselaw: "Redcorn v. State Farm Mut. Auto. Ins. Co., 55 P.3d 1017 (Okla. 2002) - DV recoverable in third-party claims", statute: "Okla. Stat. tit. 36, § 1250.4 - Unfair claims practices", time: "30 days to respond to claim", tips: "Professional documentation critical. Reference Texas precedents."},
        "OR": {name: "Oregon", strength: "🟡 Moderate", law: "Oregon permits diminished value claims though case law is developing.", caselaw: "Onita Pac. Corp. v. Trustees of Bronson, 315 Or. 149 (1992) - Economic loss includes market value diminution", statute: "Or. Rev. Stat. § 746.230 - Unfair claims practices", time: "30 days to acknowledge claim", tips: "Strong documentation essential. Reference Washington and California precedents."},
        "PA": {name: "Pennsylvania", strength: "🟢 Strong", law: "Pennsylvania recognizes diminished value with favorable case law for claimants.", caselaw: "Siegendorf v. Straubmuller, 432 Pa. 37 (1968) - Market value loss compensable", statute: "40 Pa. Stat. § 1171.5 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong consumer protections. Cite Siegendorf case and unfair practices statute."},
        "RI": {name: "Rhode Island", strength: "🟡 Moderate", law: "Rhode Island permits diminished value recovery as property damage.", caselaw: "Colgan v. Agostinucci, 588 A.2d 1385 (R.I. 1991) - Economic loss recoverable", statute: "R.I. Gen. Laws § 27-9-3 - Unfair claims practices", time: "30 days to respond to claim", tips: "Professional documentation important. Reference Massachusetts precedents."},
        "SC": {name: "South Carolina", strength: "🟢 Strong", law: "South Carolina strongly recognizes diminished value with clear case law.", caselaw: "Ashford v. Stringer, 342 S.C. 27 (2000) - Diminished value explicitly compensable", statute: "S.C. Code Ann. § 38-59-20 - Unfair claim settlement practices", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong case law. Cite Ashford case and unfair practices statute."},
        "SD": {name: "South Dakota", strength: "🟡 Moderate", law: "South Dakota permits diminished value claims though precedent is limited.", caselaw: "Farmers Ins. Exch. v. RNK, Inc., 632 N.W.2d 777 (S.D. 2001) - Property damage includes market value loss", statute: "S.D. Codified Laws § 58-33-67 - Unfair claims practices", time: "30 days to respond to claim", tips: "Strong documentation essential. Reference Nebraska and Iowa precedents."},
        "TN": {name: "Tennessee", strength: "🟢 Strong", law: "Tennessee courts consistently recognize diminished value as compensable property damage.", caselaw: "Myint v. Allstate Ins. Co., 970 S.W.2d 920 (Tenn. 1998) - Diminished value recoverable", statute: "Tenn. Code Ann. § 56-8-104 - Unfair claim settlement practices", time: "15 days to acknowledge, 60 days to resolve", tips: "Strong case law. Cite Myint case and unfair practices statute."},
        "TX": {name: "Texas", strength: "🟢 Very Strong", law: "Texas has exceptionally favorable diminished value law with strong statutory protections.", caselaw: "Bradshaw v. State Farm Lloyds, 157 S.W.3d 842 (Tex. 2005) - Landmark DV case", statute: "Tex. Ins. Code § 542.003 - Prompt Payment of Claims Act; § 541.060 - Unfair Claims Practices", time: "15 days to acknowledge, 15 days to accept or deny after receiving all materials", tips: "Texas is second-strongest DV state after Georgia. Cite Bradshaw case and Prompt Payment Act."},
        "UT": {name: "Utah", strength: "🟡 Moderate", law: "Utah recognizes diminished value as economic loss in property damage claims.", caselaw: "Mahmood v. Ross, 990 P.2d 933 (Utah 1999) - Market value diminution compensable", statute: "Utah Code § 31A-26-303 - Unfair claims practices", time: "30 days to acknowledge claim", tips: "Professional documentation critical. Reference Colorado precedents."},
        "VT": {name: "Vermont", strength: "🟡 Moderate", law: "Vermont permits diminished value recovery though case law is developing.", caselaw: "Fagnant v. Highland Dairy Farms, 147 Vt. 262 (1986) - Economic loss includes market value loss", statute: "8 V.S.A. § 4724 - Unfair claims practices", time: "30 days to respond to claim", tips: "Strong documentation essential. Reference New Hampshire precedents."},
        "VA": {name: "Virginia", strength: "🟡 Moderate", law: "Virginia recognizes diminished value as compensable property damage.", caselaw: "Flip Mortg. Corp. v. McElhone, 258 Va. 324 (1999) - Property damage includes market value loss", statute: "Va. Code Ann. § 38.2-510 - Unfair claim settlement practices", time: "30 days to acknowledge claim", tips: "Professional documentation important. Reference Maryland and D.C. precedents."},
        "WA": {name: "Washington", strength: "🟢 Strong", law: "Washington strongly recognizes diminished value with favorable consumer protections.", caselaw: "Burnside v. Simpson Paper Co., 123 Wash. 2d 93 (1994) - Diminished value recoverable", statute: "Wash. Rev. Code § 48.30.010 - Unfair claim settlement practices; Consumer Protection Act", time: "30 days to acknowledge, 45 days to resolve", tips: "Strong consumer state. Cite Consumer Protection Act and unfair practices statute."},
        "WV": {name: "West Virginia", strength: "🟡 Moderate", law: "West Virginia permits diminished value claims as economic loss.", caselaw: "Alkire v. First Nat'l Bank, 197 W. Va. 122 (1996) - Market value loss compensable", statute: "W. Va. Code § 33-11-4 - Unfair claims practices", time: "30 days to respond to claim", tips: "Professional documentation critical. Reference Ohio and Virginia precedents."},
        "WI": {name: "Wisconsin", strength: "🟡 Moderate", law: "Wisconsin recognizes diminished value though recovery standards are developing.", caselaw: "Falkner v. Northern Wis. Co-op Tobacco Pool, 182 Wis. 2d 429 (1994) - Economic loss recoverable", statute: "Wis. Stat. § 628.34 - Unfair claim settlement practices", time: "30 days to acknowledge claim", tips: "Strong documentation essential. Reference Illinois and Minnesota precedents."},
        "WY": {name: "Wyoming", strength: "🟡 Moderate", law: "Wyoming permits diminished value recovery as property damage.", caselaw: "Sinclair Oil Corp. v. Republic Ins. Co., 929 P.2d 535 (Wyo. 1996) - Property damage includes market value loss", statute: "Wyo. Stat. § 26-13-124 - Unfair claims practices", time: "30 days to respond to claim", tips: "Professional documentation important. Reference Colorado and Montana precedents."}
    };

    // ===== CORE FUNCTIONS =====
    
    // Preparation Checklist
    function toggleCheckbox(item) {
        const checkbox = item.querySelector('.prep-checkbox');
        checkbox.classList.toggle('checked');
        
        // Add checkmark SVG if checked
        if (checkbox.classList.contains('checked')) {
            checkbox.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
        } else {
            checkbox.innerHTML = '';
        }
        
        checkAllPrepItems();
    }

    function checkAllPrepItems() {
        const items = document.querySelectorAll('.prep-item .prep-checkbox');
        const allChecked = Array.from(items).every(cb => cb.classList.contains('checked'));
        if (allChecked) {
            setTimeout(() => {
                // Auto-minimize the checklist
                minimizeChecklist();
                showToast('✓ All items checked! Checklist minimized', 'success');
                haptic('medium');
            }, 800);
        }
    }

    function minimizeChecklist() {
        const checklist = document.getElementById('prepChecklist');
        checklist.classList.toggle('minimized');
        
        // Save state to localStorage
        const isMinimized = checklist.classList.contains('minimized');
        localStorage.setItem('checklistMinimized', isMinimized);
    }

    // Tab Switching with Progress

    // Switch tab and scroll to specific section
    function switchTabAndScroll(tabName, stepNum, sectionId) {
        // First switch the tab
        switchTab(tabName, stepNum);
        
        // Then scroll to the specific section after a brief delay
        setTimeout(() => {
            const section = document.getElementById(sectionId);
            if (section) {
                const yOffset = -100; // Space above section
                const y = section.getBoundingClientRect().top + window.pageYOffset + yOffset;
                window.scrollTo({top: y, behavior: 'smooth'});
            }
        }, 300);
    }

    function switchTab(tabName, stepNum) {
        // Update current tab index for swipe navigation
        currentTabIndex = tabOrder.indexOf(tabName);
        
        // Save progress
        saveProgress();
        
        // Update tab visibility
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        
        const contentElement = document.getElementById('content-' + tabName);
        const tabElement = document.getElementById('tab-' + tabName);
        
        if (!contentElement || !tabElement) {
            console.error('Tab elements not found for:', tabName);
            return;
        }
        
        contentElement.classList.add('active');
        tabElement.classList.add('active');
        
        // Haptic feedback on tab switch (mobile only)
        haptic('light');
        
        // Activate wake lock when viewing state laws (keeps screen on)
        if (tabName === 'laws') {
            requestWakeLock();
        } else {
            releaseWakeLock();
        }
        
        // Trigger confetti for Complete Package tab (once per session)
        if (tabName === 'complete') {
            const confettiPlayed = sessionStorage.getItem('cfgConfettiPlayed');
            if (!confettiPlayed) {
                setTimeout(() => {
                    triggerConfetti();
                    sessionStorage.setItem('cfgConfettiPlayed', 'true');
                }, 300); // Small delay for tab transition
            }
        }
        
        // Hide sticky CTA on tab switch (it will show again if conditions are met)
        const stickyCTA = document.getElementById('stickyCTA');
        if (stickyCTA && tabName !== 'info') {
            stickyCTA.classList.remove('show');
        }
        
        // Update progress
        updateProgress(stepNum);
        
        // Update sidebar
        updateSidebar(stepNum);
        
        // Scroll to tabs container (top of section, not page top)
        const tabsContainer = document.querySelector('.tabs-container');
        if (tabsContainer) {
            const yOffset = -20; // 20px above tabs
            const y = tabsContainer.getBoundingClientRect().top + window.pageYOffset + yOffset;
            window.scrollTo({top: y, behavior: 'smooth'});
        }
    }

    function updateProgress(stepNum) {
        const steps = document.querySelectorAll('.progress-step');
        const progressFill = document.getElementById('progressFill');
        const progressPercentage = document.getElementById('progressPercentage');
        
        steps.forEach((step, index) => {
            const num = index + 1;
            step.classList.remove('active', 'completed');
            
            if (num < stepNum) {
                step.classList.add('completed');
                step.querySelector('.progress-step-circle').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
            } else if (num === stepNum) {
                step.classList.add('active');
                step.querySelector('.progress-step-circle').textContent = num;
            } else {
                step.querySelector('.progress-step-circle').textContent = num;
            }
        });
        
        // Update progress bar
        const percentage = ((stepNum - 1) / 5) * 100;
        progressFill.style.width = percentage + '%';
        
        // Update percentage text
        progressPercentage.textContent = `Step ${stepNum} of 6 - ${Math.round(percentage)}% Complete`;
    }

    function updateSidebar(stepNum) {
        const sidebarSteps = document.querySelectorAll('.step');
        sidebarSteps.forEach((step, index) => {
            const num = index + 1;
            step.classList.remove('active', 'completed');
            
            if (num < stepNum) {
                step.classList.add('completed');
            } else if (num === stepNum) {
                step.classList.add('active');
            }
        });
        
        // Update floating progress indicator (tablet/mobile)
        updateFloatingProgress(stepNum);
    }

    // FAQ Toggle
    function toggleFAQ(item) {
        // Close all other FAQ items (accordion behavior)
        const allFAQs = document.querySelectorAll('.faq-item');
        allFAQs.forEach(faq => {
            if (faq !== item) {
                faq.classList.remove('open');
            }
        });
        
        // Toggle the clicked one
        item.classList.toggle('open');
    }

    // Info Box Toggle (for Fair Claim Submission Playbook™ collapsible sections)
    function toggleInfoBox(box) {
        // Close all other info boxes (accordion behavior)
        const allInfoBoxes = document.querySelectorAll('.info-box');
        allInfoBoxes.forEach(infoBox => {
            if (infoBox !== box) {
                infoBox.classList.remove('open');
            }
        });
        
        // Toggle the clicked one
        box.classList.toggle('open');
        haptic('light');
    }

    // Auto-formatting Functions
    function formatPhone(input) {
        let value = input.value.replace(/\D/g, '');
        if (value.length > 0) {
            if (value.length <= 3) {
                value = `(${value}`;
            } else if (value.length <= 6) {
                value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
            } else {
                value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
            }
        }
        input.value = value;
    }

    function formatCurrency(input) {
        let value = input.value.replace(/[^\d.]/g, '');
        if (value) {
            // Remove extra decimal points
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            // Format with dollar sign and commas
            const num = parseFloat(value);
            if (!isNaN(num)) {
                input.value = '$' + num.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 2});
            }
        }
    }

    function formatMileage(input) {
        let value = input.value.replace(/\D/g, '');
        if (value) {
            input.value = parseInt(value).toLocaleString('en-US');
        }
    }

    function formatVIN(input) {
        input.value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    }

    // Field Validation
    function validateField(input) {
        const formGroup = input.closest('.form-group');
        const value = input.value.trim();
        const field = formGroup.dataset.field;
        
        let isValid = false;
        let errorMsg = '';
        
        // Check if required field
        const isRequired = input.hasAttribute('required') || formGroup.querySelector('.required');
        
        if (isRequired && !value) {
            errorMsg = 'This field is required';
        } else if (value) {
            // Validate based on field type
            if (field === 'email' || input.type === 'email') {
                isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                errorMsg = isValid ? '' : 'Please enter a valid email address';
            } else if (field === 'phone') {
                isValid = value.replace(/\D/g, '').length === 10;
                errorMsg = isValid ? '' : 'Phone number must be 10 digits';
            } else if (field === 'vin') {
                isValid = value.length === 17;
                errorMsg = isValid ? '' : 'VIN must be exactly 17 characters';
            } else if (field === 'diminishedValue') {
                const numValue = parseFloat(value.replace(/[^\d.]/g, ''));
                isValid = !isNaN(numValue) && numValue > 0;
                errorMsg = isValid ? '' : 'Please enter a valid amount';
            } else if (field === 'fullName' || field === 'vehicle') {
                isValid = value.length >= 2;
                errorMsg = isValid ? '' : 'Please enter a valid value';
            } else if (field === 'state') {
                isValid = value !== '';
                errorMsg = isValid ? '' : 'Please select a state';
            } else {
                isValid = true;
            }
        } else if (!isRequired) {
            isValid = true;
        }
        
        // Update UI
        formGroup.classList.remove('valid', 'error');
        const existingError = formGroup.querySelector('.error-text');
        if (existingError) existingError.remove();
        
        const validationIcon = formGroup.querySelector('.validation-icon');
        if (validationIcon) {
            if (isValid && value) {
                formGroup.classList.add('valid');
                validationIcon.textContent = '✓';
                validationIcon.style.color = '#10b981';
            } else if (errorMsg) {
                formGroup.classList.add('error');
                validationIcon.textContent = '✕';
                validationIcon.style.color = '#ef4444';
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-text';
                errorDiv.textContent = errorMsg;
                formGroup.appendChild(errorDiv);
            } else {
                validationIcon.textContent = '';
            }
        }
        
        return isValid;
    }

    // Auto-save functionality
    let saveTimeout;
    function autoSave() {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
            const formData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                vehicle: document.getElementById('vehicle').value,
                vin: document.getElementById('vin').value,
                mileage: document.getElementById('mileage').value,
                diminishedValue: document.getElementById('diminishedValue').value,
                state: document.getElementById('state').value,
                insuranceCompany: document.getElementById('insuranceCompany').value,
                policyNumber: document.getElementById('policyNumber').value,
                claimNumber: document.getElementById('claimNumber').value,
                adjusterName: document.getElementById('adjusterName').value,
                adjusterEmail: document.getElementById('adjusterEmail').value
            };
            
            localStorage.setItem('cfgFormData', JSON.stringify(formData));
            
            // Mark form as changed for navigation warning
            markFormAsChanged();
            
            // Show save indicator
            const indicator = document.getElementById('autosaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }, 1000);
    }

    // Load saved data
    function loadSavedData() {
        const saved = localStorage.getItem('cfgFormData');
        if (saved) {
            const data = JSON.parse(saved);
            Object.keys(data).forEach(key => {
                const input = document.getElementById(key);
                if (input && data[key]) {
                    input.value = data[key];
                    validateField(input);
                }
            });
        }
    }

    // Save info and proceed
    function saveInfo() {
        const requiredFields = ['fullName', 'diminishedValue', 'state'];
        let allValid = true;
        let missingFields = [];
        
        for (let id of requiredFields) {
            const input = document.getElementById(id);
            if (!input.value) {
                allValid = false;
                const fieldName = input.closest('.form-group').querySelector('label').textContent.replace('*', '').trim();
                missingFields.push(fieldName);
                const formGroup = input.closest('.form-group');
                formGroup.classList.add('error');
            }
        }
        
        if (!allValid) {
            // Auto-scroll to first error
            scrollToFirstError();
            haptic('error');
            return;
        }
        
        autoSave();
        markFormAsChanged(); // Track for navigation warning
        
        // Mark sidebar step 3 as completed (green)
        const sidebarStep3 = document.querySelector('.step[data-sidebar-step="3"]');
        if (sidebarStep3) {
            sidebarStep3.classList.add('completed');
            sidebarStep3.classList.remove('active');
        }
        
        // Show success toast
        showToast('✓ Information saved successfully!', 'success');
        haptic('success');
        
        // Auto-switch to letter tab and scroll to Generate Demand Letter section
        setTimeout(() => {
            switchTabAndScroll('letter', 4, 'section-letter');
        }, 500);
    }

    // Generate Demand Letter
    function generateLetter() {
        const btn = document.getElementById('generateLetterBtn');
        btn.disabled = true;
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px; animation: spin 1s linear infinite;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg> Generating...';
        
        setTimeout(() => {
            const name = document.getElementById('fullName').value;
            const ins = document.getElementById('insuranceCompany').value || '[Insurance Company Name]';
            const amt = document.getElementById('diminishedValue').value;
            const stateCode = document.getElementById('state').value;
            
            if (!name || !amt || !stateCode) {
                btn.disabled = false;
                btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg> Generate My Demand Letter';
                showToast('Please complete the required fields first', 'error');
                haptic('error');
                switchTab('info', 3);
                setTimeout(scrollToFirstError, 500);
                return;
            }
            
            const state = STATES[stateCode];
            const today = new Date().toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric'});
            const policyNum = document.getElementById('policyNumber').value;
            const claimNum = document.getElementById('claimNumber').value;
            
            let referenceLine = 'RE: Diminished Value Claim';
            if (policyNum && claimNum) {
                referenceLine += ` - Policy #${policyNum}, Claim #${claimNum}`;
            } else if (policyNum) {
                referenceLine += ` - Policy #${policyNum}`;
            } else if (claimNum) {
                referenceLine += ` - Claim #${claimNum}`;
            }
            
            const letter = `${today}

${name}
${document.getElementById('address').value || ''}
${document.getElementById('email').value}
${document.getElementById('phone').value}

${ins}
Claims Department

${referenceLine}

Dear Claims Representative:

I am submitting a formal diminished value claim for my ${document.getElementById('vehicle').value}, VIN: ${document.getElementById('vin').value}.

CLAIM AMOUNT: ${amt}

Despite professional repairs following the accident, my vehicle has suffered permanent and measurable loss in fair market value due to its accident history. This diminished value is documented in professional valuation reports from MyFairClaim, prepared in accordance with industry-standard methodologies.

LEGAL BASIS - ${state.name.toUpperCase()}

${state.law}

Supporting Case Law:
${state.caselaw}

Applicable Statute:
${state.statute}

Under ${state.name} law, I am entitled to full recovery of diminished value as an established and compensable element of property damage. Diminished value represents the difference between my vehicle's fair market value before the accident and its fair market value after repairs, accounting for the permanent stigma of accident history in the marketplace.

PAYMENT REQUEST

I request payment of ${amt} within the timeframe required by ${state.name} law: ${state.time}.

Failure to respond within this timeframe or to provide payment may constitute unfair claims settlement practices under applicable state law.

SUPPORTING DOCUMENTATION

Enclosed please find:
• Fair Market Impact Report (professional diminished value assessment)
• Fair Market Value Report (independent market valuation)
• Complete repair documentation
• Photographs and supporting evidence

NEXT STEPS

If this claim is denied, I request a detailed written explanation citing specific policy language or legal authority supporting the denial. If this claim is delayed beyond the statutory timeframe, I will file a formal complaint with the ${state.name} Department of Insurance and pursue all available legal remedies, including potential bad faith litigation.

I am available to discuss this claim at your convenience. Please contact me at the information provided above.

Sincerely,

${name}

Enclosures: Professional Valuation Reports`;
            
            document.getElementById('letterText').textContent = letter;
            document.getElementById('letterOutput').style.display = 'block';
            
            // Update response time in next steps
            const responseTimeEl = document.getElementById('responseTime');
            if (responseTimeEl) {
                const timeMatch = state.time.match(/(\d+)\s*days/);
                if (timeMatch) {
                    responseTimeEl.textContent = timeMatch[1];
                } else {
                    responseTimeEl.textContent = '30-60';
                }
            }
            
            document.getElementById('letterOutput').scrollIntoView({behavior: 'smooth', block: 'start'});
            
            // Mark step 4 as completed
            const step4 = document.querySelector('.progress-step[data-step="4"]');
            if (step4) {
                step4.classList.add('completed');
                step4.classList.remove('active');
                step4.querySelector('.progress-step-circle').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
            }
            
            // Update progress bar to 60%
            const progressFill = document.getElementById('progressFill');
            const progressPercentage = document.getElementById('progressPercentage');
            if (progressFill) progressFill.style.width = '60%';
            if (progressPercentage) progressPercentage.textContent = 'Step 4 of 6 - 60% Complete';
            
            // Mark sidebar step 4 as completed
            const sidebarStep4 = document.querySelector('.step[data-sidebar-step="4"]');
            if (sidebarStep4) {
                sidebarStep4.classList.add('completed');
                sidebarStep4.classList.remove('active');
            }
            
            btn.disabled = false;
            btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg> Generate My Demand Letter';
            
            // Show success notification
            showToast('✓ Demand letter generated successfully!', 'success');
            haptic('success');
        }, 500);
    }

    // Generate Email
    function generateEmail() {
        const btn = document.getElementById('generateEmailBtn');
        btn.disabled = true;
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px; animation: spin 1s linear infinite;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg> Generating...';
        
        setTimeout(() => {
            const name = document.getElementById('fullName').value;
            const ins = document.getElementById('insuranceCompany').value || '[Insurance Company Name]';
            const amt = document.getElementById('diminishedValue').value;
            const stateCode = document.getElementById('state').value;
            
            if (!name || !amt || !stateCode) {
                btn.disabled = false;
                btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg> Generate My Email Template';
                showToast('Please complete the required fields first', 'error');
                haptic('error');
                switchTab('info', 3);
                setTimeout(scrollToFirstError, 500);
                return;
            }
            
            const state = STATES[stateCode];
            const subject = `Formal Diminished Value Claim - ${document.getElementById('vehicle').value} - Claim #${document.getElementById('claimNumber').value || '[Claim Number]'}`;
            
            const body = `Dear ${document.getElementById('adjusterName').value || 'Claims Representative'},

I am submitting a formal diminished value claim for the following vehicle:

CLAIM DETAILS
Amount: ${amt}
Vehicle: ${document.getElementById('vehicle').value}
VIN: ${document.getElementById('vin').value}
Policy/Claim: ${document.getElementById('policyNumber').value || '[Policy]'} / ${document.getElementById('claimNumber').value || '[Claim]'}

Despite professional repairs, my vehicle has suffered permanent and measurable loss in fair market value due to its accident history, as documented in the attached professional valuation reports.

LEGAL BASIS - ${state.name.toUpperCase()}

${state.law}

Supporting Case Law: ${state.caselaw}

Applicable Statute: ${state.statute}

Under ${state.name} law, I am entitled to full recovery of diminished value as a compensable element of property damage. I request payment of ${amt} within the legally required timeframe: ${state.time}.

ATTACHED DOCUMENTATION
1. Fair_Market_Impact_Report.pdf (professional DV assessment)
2. Fair_Market_Value_Report.pdf (independent market valuation)
3. Repair documentation and supporting evidence

NEXT STEPS
Please confirm receipt of this claim and provide a timeline for review. If denied, I require a detailed written explanation with specific policy or legal citations. Delays beyond the statutory timeframe may result in a Department of Insurance complaint and pursuit of all available legal remedies.

I am available to discuss this claim at your convenience.

Contact Information:
Phone: ${document.getElementById('phone').value}
Email: ${document.getElementById('email').value}

Best regards,
${name}`;
            
            const emailText = `Subject: ${subject}

To: ${document.getElementById('adjusterEmail').value || '[Adjuster Email]'}

${body}`;
            
            document.getElementById('emailText').textContent = emailText;
            
            // Setup mailto link
            const mailtoLink = `mailto:${encodeURIComponent(document.getElementById('adjusterEmail').value || '')}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            const openDraftBtn = document.getElementById('openEmailDraftBtn');
            if (openDraftBtn) {
                openDraftBtn.onclick = () => window.location.href = mailtoLink;
            }
            
            document.getElementById('emailOutput').style.display = 'block';
            document.getElementById('emailCelebration').classList.add('show');
            document.getElementById('emailOutput').scrollIntoView({behavior: 'smooth', block: 'start'});
            
            // Mark step 5 as completed
            const step5 = document.querySelector('.progress-step[data-step="5"]');
            if (step5) {
                step5.classList.add('completed');
                step5.classList.remove('active');
                step5.querySelector('.progress-step-circle').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
            }
            
            // Update progress bar to 80%
            const progressFill = document.getElementById('progressFill');
            const progressPercentage = document.getElementById('progressPercentage');
            if (progressFill) progressFill.style.width = '80%';
            if (progressPercentage) progressPercentage.textContent = 'Step 5 of 6 - 80% Complete';
            
            // Mark sidebar step 5 as completed
            const sidebarStep5 = document.querySelector('.step[data-sidebar-step="5"]');
            if (sidebarStep5) {
                sidebarStep5.classList.add('completed');
                sidebarStep5.classList.remove('active');
            }
            
            btn.disabled = false;
            btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 24px; height: 24px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg> Generate My Email Template';
            
            // Show success notification and mark as complete
            showToast('✓ Email template generated successfully!', 'success');
            haptic('success');
            markFormAsComplete(); // All steps complete, no navigation warning
        }, 500);
    }

    // Download Letter as PDF
    function downloadLetterPDF() {
        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const letterText = document.getElementById('letterText').textContent;
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 25;
            const maxWidth = pageWidth - (margin * 2);
            let yPosition = margin;
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            
            const lines = letterText.split('\n');
            
            const formatAmount = (text) => {
                if (text.includes('CLAIM AMOUNT:')) {
                    const amountMatch = text.match(/CLAIM AMOUNT:\s*\$?([\d,]+\.?\d*)/);
                    if (amountMatch) {
                        const amount = amountMatch[1].replace(/,/g, '');
                        const formatted = new Intl.NumberFormat('en-US', {
                            style: 'currency',
                            currency: 'USD'
                        }).format(parseFloat(amount));
                        return text.replace(/CLAIM AMOUNT:.*/, `CLAIM AMOUNT: ${formatted}`);
                    }
                    return text;
                }
                if (text.match(/payment of \$?([\d,]+\.?\d*)/i)) {
                    return text.replace(/payment of \$?([\d,]+\.?\d*)/gi, (match, amount) => {
                        const cleaned = amount.replace(/,/g, '');
                        const formatted = new Intl.NumberFormat('en-US', {
                            style: 'currency',
                            currency: 'USD'
                        }).format(parseFloat(cleaned));
                        return `payment of ${formatted}`;
                    });
                }
                return text;
            };
            
            lines.forEach((line) => {
                line = formatAmount(line);
                
                if (line.trim() === '') {
                    yPosition += 4;
                    return;
                }
                
                if (yPosition > pageHeight - 30) {
                    doc.addPage();
                    yPosition = margin;
                }
                
                const isSectionHeader = line.includes('CLAIM AMOUNT:') || 
                                       line.includes('LEGAL BASIS') || 
                                       line.includes('PAYMENT REQUEST') || 
                                       line.includes('SUPPORTING DOCUMENTATION') || 
                                       line.includes('NEXT STEPS') || 
                                       line.includes('RE:');
                const isSubHeader = line.includes('Supporting Case Law:') || 
                                   line.includes('Applicable Statute:') || 
                                   line.includes('Enclosures:');
                
                if (isSectionHeader) {
                    if (yPosition > margin + 10) {
                        yPosition += 8;
                    }
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(12);
                    const wrappedLines = doc.splitTextToSize(line, maxWidth);
                    wrappedLines.forEach(wrappedLine => {
                        if (yPosition > pageHeight - 30) {
                            doc.addPage();
                            yPosition = margin;
                        }
                        doc.text(wrappedLine, margin, yPosition);
                        yPosition += 7;
                    });
                    yPosition += 3;
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(11);
                } else if (isSubHeader) {
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(11);
                    const wrappedLines = doc.splitTextToSize(line, maxWidth);
                    wrappedLines.forEach(wrappedLine => {
                        if (yPosition > pageHeight - 30) {
                            doc.addPage();
                            yPosition = margin;
                        }
                        doc.text(wrappedLine, margin, yPosition);
                        yPosition += 6;
                    });
                    doc.setFont('helvetica', 'normal');
                } else if (line.startsWith('•')) {
                    const wrappedLines = doc.splitTextToSize(line, maxWidth - 5);
                    wrappedLines.forEach((wrappedLine, i) => {
                        if (yPosition > pageHeight - 30) {
                            doc.addPage();
                            yPosition = margin;
                        }
                        doc.text(wrappedLine, margin + (i > 0 ? 5 : 0), yPosition);
                        yPosition += 6;
                    });
                } else if (line.includes('Sincerely,')) {
                    yPosition += 4;
                    doc.setFont('helvetica', 'normal');
                    doc.text(line, margin, yPosition);
                    yPosition += 20;
                } else {
                    doc.setFontSize(11);
                    const wrappedLines = doc.splitTextToSize(line, maxWidth);
                    wrappedLines.forEach(wrappedLine => {
                        if (yPosition > pageHeight - 30) {
                            doc.addPage();
                            yPosition = margin;
                        }
                        doc.text(wrappedLine, margin, yPosition);
                        yPosition += 6;
                    });
                    if (line.trim().length > 0 && !line.startsWith(' ')) {
                        yPosition += 1;
                    }
                }
            });
            
            const fileName = `Demand_Letter_${document.getElementById('fullName').value.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            
            alert(`✅ PDF Downloaded Successfully!\n\nYour demand letter has been saved as:\n${fileName}\n\n📋 Next Steps:\n1. Check your Downloads folder\n2. Print and sign in blue ink\n3. Attach your MyFairClaim reports\n4. Send via USPS Certified Mail with Return Receipt`);
        } catch (error) {
            console.error('PDF generation error:', error);
            alert('❌ PDF generation failed. Please try downloading as TXT instead or contact support.\n\nError: ' + error.message);
        }
    }

    // Copy text to clipboard
    function copyText(elementId) {
        const text = document.getElementById(elementId).textContent;
        const docType = elementId.includes('letter') ? 'Demand Letter' : 'Email Template';
        
        copyToClipboardEnhanced(text, `✓ ${docType} copied to clipboard!`)
            .catch(() => {
                showToast('Copy failed. Please try selecting the text manually.', 'error');
            });
    }

    // Download as text file
    function downloadText(elementId, filename) {
        const text = document.getElementById(elementId).textContent;
        const blob = new Blob([text], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
        
        showToast(`✓ Downloaded as ${filename}!`, 'success');
        haptic('success');
    }

    // Load states into dropdown and grid
    function loadStates() {
        const select = document.getElementById('state');
        const searchSelect = document.getElementById('stateSearch');
        const sorted = Object.keys(STATES).sort((a, b) => 
            STATES[a].name.localeCompare(STATES[b].name)
        );
        
        sorted.forEach(code => {
            const opt = document.createElement('option');
            opt.value = code;
            opt.textContent = STATES[code].name;
            select.appendChild(opt);
            
            // Also add to state search dropdown
            const searchOpt = document.createElement('option');
            searchOpt.value = code;
            searchOpt.textContent = STATES[code].name;
            searchSelect.appendChild(searchOpt);
        });
        
        const grid = document.getElementById('stateLawGrid');
        sorted.forEach(code => {
            const s = STATES[code];
            const card = document.createElement('div');
            card.className = 'state-card';
            card.setAttribute('data-state-code', code);
            card.innerHTML = `
                <h3>${s.name}</h3>
                <div class="state-strength">${s.strength}</div>
                <div class="state-details">
                    <p>${s.law}</p>
                    <strong>Key Case:</strong>
                    <p>${s.caselaw}</p>
                    <strong>Statute:</strong>
                    <p>${s.statute}</p>
                    <strong>Response Time:</strong>
                    <p>${s.time}</p>
                    <strong>Filing Tips:</strong>
                    <p>${s.tips}</p>
                </div>
            `;
            grid.appendChild(card);
        });
    }
    
    // Filter states by dropdown selection
    function filterStatesByDropdown(stateCode) {
        const cards = document.querySelectorAll('.state-card');
        if (!stateCode) {
            // Show all if no selection
            cards.forEach(card => card.style.display = 'block');
        } else {
            // Show only selected state
            cards.forEach(card => {
                card.style.display = card.getAttribute('data-state-code') === stateCode ? 'block' : 'none';
            });
            // Scroll to the state grid
            document.getElementById('stateLawGrid').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }

    // Prefill from URL parameters
    function prefillFromURL() {
        try {
            const params = new URLSearchParams(window.location.search);
            if (params.get('name')) document.getElementById('fullName').value = decodeURIComponent(params.get('name'));
            if (params.get('email')) document.getElementById('email').value = decodeURIComponent(params.get('email'));
            if (params.get('phone')) document.getElementById('phone').value = decodeURIComponent(params.get('phone'));
            if (params.get('address')) document.getElementById('address').value = decodeURIComponent(params.get('address'));
            if (params.get('vehicle')) document.getElementById('vehicle').value = decodeURIComponent(params.get('vehicle'));
            if (params.get('vin')) document.getElementById('vin').value = decodeURIComponent(params.get('vin'));
            if (params.get('amount')) document.getElementById('diminishedValue').value = decodeURIComponent(params.get('amount'));
            if (params.get('state')) {
                const stateCode = params.get('state').toUpperCase();
                const stateSelect = document.getElementById('state');
                const stateSearchSelect = document.getElementById('stateSearch');
                
                // Check if state exists in options
                if (stateSelect.querySelector(`option[value="${stateCode}"]`)) {
                    stateSelect.value = stateCode;
                    // Also prefill state search dropdown and filter
                    stateSearchSelect.value = stateCode;
                    filterStatesByDropdown(stateCode);
                }
            }
            if (params.get('mileage')) document.getElementById('mileage').value = decodeURIComponent(params.get('mileage'));
            if (params.get('insurance')) document.getElementById('insuranceCompany').value = decodeURIComponent(params.get('insurance'));
            if (params.get('policy')) document.getElementById('policyNumber').value = decodeURIComponent(params.get('policy'));
            if (params.get('claim')) document.getElementById('claimNumber').value = decodeURIComponent(params.get('claim'));
        } catch (err) {
            console.log('URL prefill error:', err);
        }
    }

    // Dismiss time banner
    // Mobile sticky CTA
    function handleStickyCtaMobile() {
        const stickyCTA = document.getElementById('stickyCTA');
        const formSection = document.getElementById('content-info');
        
        // Only show sticky CTA on mobile
        if (window.innerWidth <= 768 && formSection) {
            let hasScrolled = false;
            
            // Track if user has scrolled
            window.addEventListener('scroll', function() {
                hasScrolled = true;
            }, { once: true });
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    // Check if we're on the info tab
                    const isOnInfoTab = document.getElementById('content-info').classList.contains('active');
                    
                    // STRICT LOGIC: Only show sticky CTA if ALL conditions are met:
                    // 1. User has scrolled at least once
                    // 2. Form section is not visible on screen
                    // 3. We're on mobile
                    // 4. We ARE on the info tab (reversed from before!)
                    // This means: only show when user scrolls down on the form page
                    if (hasScrolled && !entry.isIntersecting && isOnInfoTab) {
                        stickyCTA.classList.add('show');
                    } else {
                        stickyCTA.classList.remove('show');
                    }
                });
            }, {threshold: 0.1});
            
            observer.observe(formSection);
            
            // Hide when switching away from info tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    setTimeout(() => {
                        const isOnInfoTab = document.getElementById('content-info').classList.contains('active');
                        if (!isOnInfoTab) {
                            stickyCTA.classList.remove('show');
                        }
                    }, 100);
                });
            });
        } else {
            // On desktop, never show sticky CTA
            if (stickyCTA) stickyCTA.classList.remove('show');
        }
    }

    // Floating Progress Indicator Functions (Tablet/Mobile)
    function toggleFloatingProgress() {
        const panel = document.getElementById('floatingProgressPanel');
        const backdrop = document.getElementById('floatingProgressBackdrop');
        
        if (panel && backdrop) {
            panel.classList.toggle('open');
            backdrop.classList.toggle('show');
            haptic('medium');
        }
    }
    
    function closeFloatingProgress() {
        const panel = document.getElementById('floatingProgressPanel');
        const backdrop = document.getElementById('floatingProgressBackdrop');
        
        if (panel && backdrop) {
            panel.classList.remove('open');
            backdrop.classList.remove('show');
            haptic('light');
        }
    }
    
    function updateFloatingProgress(stepNum) {
        // Update badge text (e.g., "3/6")
        const badgeText = document.getElementById('floatingProgressText');
        if (badgeText) {
            badgeText.textContent = stepNum + '/6';
        }
        
        // Update panel content by cloning sidebar steps
        const floatingSteps = document.getElementById('floatingProgressSteps');
        const sidebarSteps = document.querySelector('.sidebar');
        
        if (floatingSteps && sidebarSteps && window.innerWidth <= 1200) {
            // Clone the sidebar content into the floating panel
            floatingSteps.innerHTML = sidebarSteps.innerHTML;
        }
    }

    // Initialize everything on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Check for reset parameter - clears all localStorage
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('reset') === 'true' || urlParams.get('clear') === 'true') {
            localStorage.removeItem('cfgTimeBannerDismissed');
            localStorage.removeItem('checklistMinimized');
            localStorage.removeItem('cfgFormData');
            localStorage.removeItem('cfgProgress');
            showToast('✓ Browser cache cleared - page reset', 'success');
        }
        
        loadStates();
        
        // Check if URL has parameters - if so, don't load saved data
        const hasURLParams = window.location.search.length > 0;
        
        // Load URL parameters first (Brevo API integration)
        prefillFromURL();
        
        // Only load saved data if NO URL parameters present
        if (!hasURLParams) {
            loadSavedData();
        }
        
        updateProgress(1);
        
        // Initialize floating progress indicator (tablet/mobile)
        updateFloatingProgress(1);
        
        // Ensure sticky CTA is hidden on page load
        const stickyCTA = document.getElementById('stickyCTA');
        if (stickyCTA) {
            stickyCTA.classList.remove('show');
        }
        
        handleStickyCtaMobile();
        
        // Force content-info perfect centering on mobile
        function fixContentInfoCentering() {
            if (window.innerWidth <= 768) {
                const contentInfo = document.getElementById('content-info');
                if (contentInfo) {
                    contentInfo.style.width = '100%';
                    contentInfo.style.maxWidth = '100%';
                    contentInfo.style.marginLeft = '0';
                    contentInfo.style.marginRight = '0';
                    contentInfo.style.paddingLeft = '16px';
                    contentInfo.style.paddingRight = '16px';
                    contentInfo.style.boxSizing = 'border-box';
                    contentInfo.style.position = 'relative';
                    contentInfo.style.left = '0';
                    contentInfo.style.transform = 'translateX(0)';
                    
                    // Fix all children
                    const children = contentInfo.children;
                    for (let i = 0; i < children.length; i++) {
                        children[i].style.width = '100%';
                        children[i].style.maxWidth = '100%';
                        children[i].style.marginLeft = '0';
                        children[i].style.marginRight = '0';
                        children[i].style.boxSizing = 'border-box';
                    }
                }
            }
        }
        fixContentInfoCentering();
        window.addEventListener('resize', fixContentInfoCentering);
        
        // Show share buttons if Web Share API is supported
        if (navigator.share) {
            const shareButtons = document.querySelectorAll('#shareLetterBtn, #shareEmailBtn');
            shareButtons.forEach(btn => {
                if (btn) btn.style.display = 'inline-flex';
            });
        }
        
        // FORCE CHECKLIST TO ALWAYS BE EXPANDED ON PAGE LOAD
        const checklistElement = document.getElementById('prepChecklist');
        if (checklistElement) {
            checklistElement.classList.remove('minimized');
            // Clear any stored minimized state
            localStorage.removeItem('checklistMinimized');
            console.log('Checklist FORCED to expanded state');
        }
        
        // Show mobile optimization status
        const mobileFeatures = [];
        if (isMobile()) mobileFeatures.push('Mobile Layout');
        if (navigator.vibrate) mobileFeatures.push('Haptic Feedback');
        if (navigator.share) mobileFeatures.push('Native Share');
        if ('ontouchstart' in window) mobileFeatures.push('Swipe Gestures');
        
        // Show swipe hint on first mobile visit
        if (isMobile() && !localStorage.getItem('swipeHintShown')) {
            setTimeout(() => {
                const hint = document.getElementById('swipeHint');
                hint.classList.add('show');
                setTimeout(() => {
                    hint.classList.remove('show');
                }, 4000);
                localStorage.setItem('swipeHintShown', 'true');
            }, 2000);
        }
        
        // Add haptic feedback to all buttons
        document.querySelectorAll('button, .btn').forEach(btn => {
            btn.addEventListener('click', () => {
                haptic('light');
            });
        });
        
        // Initialize new features
        initDarkMode();
        initAutocomplete();
        restoreProgress();
        resetSessionTimer();
        logPerformance();
        
        console.log('✅ CFG Enhanced v3.0 Complete - FULLY OPTIMIZED');
        console.log('📱 Mobile Features Active:', mobileFeatures.join(', ') || 'Desktop Mode');
        console.log('🎯 New Features: Dark Mode, Session Timeout, Keyboard Shortcuts, Voice Input, Pull-to-Refresh, Autocomplete, Progress Persistence, Offline Detection');
    });

    // ============================================
    // VOICE INPUT FEATURE (Progressive Enhancement)
    // ============================================
    
    function initVoiceInput() {
        // Only on mobile devices with speech recognition support
        if (!isMobile()) return;
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            console.log('Voice input not supported on this device');
            return;
        }
        
        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';
        
        // Add voice buttons to text input fields (names, addresses, etc)
        const voiceFields = ['fullName', 'address', 'city', 'adjusterName', 'claimNumber'];
        
        voiceFields.forEach(fieldId => {
            const input = document.getElementById(fieldId);
            if (!input) return;
            
            const formGroup = input.closest('.form-group');
            if (!formGroup) return;
            
            // Mark form group as having voice
            formGroup.classList.add('with-voice');
            
            // Create voice button
            const voiceBtn = document.createElement('button');
            voiceBtn.type = 'button';
            voiceBtn.className = 'voice-input-btn';
            voiceBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                </svg>
            `;
            voiceBtn.style.display = 'flex'; // Show on mobile
            
            // Insert voice button
            formGroup.style.position = 'relative';
            formGroup.appendChild(voiceBtn);
            
            // Handle voice button click
            voiceBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                voiceBtn.classList.add('listening');
                haptic('medium');
                
                recognition.start();
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    input.value = transcript;
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                    voiceBtn.classList.remove('listening');
                    haptic('success');
                    showToast('✓ Voice input captured!');
                    autoSave();
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    voiceBtn.classList.remove('listening');
                    if (event.error !== 'no-speech' && event.error !== 'aborted') {
                        showToast('Voice input failed. Please try again.', 'error');
                    }
                    haptic('error');
                };
                
                recognition.onend = () => {
                    voiceBtn.classList.remove('listening');
                };
                
                // Stop after 5 seconds of silence
                setTimeout(() => {
                    try { recognition.stop(); } catch(e) {}
                }, 5000);
            });
        });
        
        console.log('✓ Voice input enabled for mobile');
    }
    
    // Initialize voice input after DOM is loaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initVoiceInput);
    } else {
        initVoiceInput();
    }

    // Add CSS animation for spinning loader
    const style = document.createElement('style');
    style.textContent = `
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    `;
    document.head.appendChild(style);

    // Confetti Animation
    function triggerConfetti() {
        const canvas = document.getElementById('confettiCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const confettiPieces = [];
        const confettiCount = 150;
        const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];
        
        class ConfettiPiece {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height - canvas.height;
                this.w = Math.random() * 10 + 5;
                this.h = Math.random() * 5 + 5;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.speed = Math.random() * 3 + 2;
                this.angle = Math.random() * 360;
                this.rotation = Math.random() * 10 - 5;
                this.opacity = 1;
            }
            
            update() {
                this.y += this.speed;
                this.angle += this.rotation;
                this.x += Math.sin(this.angle * Math.PI / 180) * 2;
                
                if (this.y > canvas.height) {
                    this.opacity -= 0.05;
                }
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(-this.w / 2, -this.h / 2, this.w, this.h);
                ctx.restore();
            }
        }
        
        // Create confetti pieces
        for (let i = 0; i < confettiCount; i++) {
            confettiPieces.push(new ConfettiPiece());
        }
        
        let animationFrameId;
        let startTime = Date.now();
        const duration = 15000; // 15 seconds
        
        function animate() {
            const elapsed = Date.now() - startTime;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            confettiPieces.forEach(piece => {
                piece.update();
                piece.draw();
            });
            
            if (elapsed < duration) {
                animationFrameId = requestAnimationFrame(animate);
            } else {
                // Clear canvas when done
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Turn step 6 green after confetti finishes
                setTimeout(() => {
                    const step6 = document.querySelector('.step[data-sidebar-step="6"]');
                    if (step6) {
                        step6.classList.add('completed');
                        step6.classList.remove('active');
                        
                        // Add green styling
                        step6.style.background = 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)';
                        step6.style.borderColor = '#10b981';
                        
                        const stepNumber = step6.querySelector('.step-number');
                        if (stepNumber) {
                            stepNumber.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>';
                            stepNumber.style.background = '#10b981';
                        }
                    }
                }, 300);
            }
        }
        
        animate();
    }

    </script>
</body>
</html>
